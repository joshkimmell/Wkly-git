import{createRequire}from"module";const require=createRequire(import.meta.url);
var EE=Object.create;var ve=Object.defineProperty;var SE=Object.getOwnPropertyDescriptor;var TE=Object.getOwnPropertyNames;var pE=Object.getPrototypeOf,uE=Object.prototype.hasOwnProperty;var Bo=t=>{throw TypeError(t)};var sn=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var _=(t,e)=>()=>(t&&(e=t(t=0)),e);var xt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),q=(t,e)=>{for(var r in e)ve(t,r,{get:e[r],enumerable:!0})},Go=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of TE(e))!uE.call(t,o)&&o!==r&&ve(t,o,{get:()=>e[o],enumerable:!(n=SE(e,o))||n.enumerable});return t};var AE=(t,e,r)=>(r=t!=null?EE(pE(t)):{},Go(e||!t||!t.__esModule?ve(r,"default",{value:t,enumerable:!0}):r,t)),k=t=>Go(ve({},"__esModule",{value:!0}),t);var Ho=(t,e,r)=>e.has(t)||Bo("Cannot "+r);var we=(t,e,r)=>(Ho(t,e,"read from private field"),r?r.call(t):e.get(t)),an=(t,e,r)=>e.has(t)?Bo("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),cn=(t,e,r,n)=>(Ho(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r);var Fo,Ko=_(()=>{Fo=typeof globalThis=="object"?globalThis:global});var jo=_(()=>{Ko()});var Wo=_(()=>{jo()});var ot,_n=_(()=>{ot="1.9.0"});function dE(t){var e=new Set([t]),r=new Set,n=t.match($o);if(!n)return function(){return!1};var o={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(o.prerelease!=null)return function(c){return c===t};function s(i){return r.add(i),!1}function a(i){return e.add(i),!0}return function(c){if(e.has(c))return!0;if(r.has(c))return!1;var E=c.match($o);if(!E)return s(c);var S={major:+E[1],minor:+E[2],patch:+E[3],prerelease:E[4]};return S.prerelease!=null||o.major!==S.major?s(c):o.major===0?o.minor===S.minor&&o.patch<=S.patch?a(c):s(c):o.minor<=S.minor?a(c):s(c)}}var $o,qo,Xo=_(()=>{_n();$o=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;qo=dE(ot)});function X(t,e,r,n){var o;n===void 0&&(n=!1);var s=$t[Wt]=(o=$t[Wt])!==null&&o!==void 0?o:{version:ot};if(!n&&s[t]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return r.error(a.stack||a.message),!1}if(s.version!==ot){var a=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+t+" does not match previously registered API v"+ot);return r.error(a.stack||a.message),!1}return s[t]=e,r.debug("@opentelemetry/api: Registered a global for "+t+" v"+ot+"."),!0}function V(t){var e,r,n=(e=$t[Wt])===null||e===void 0?void 0:e.version;if(!(!n||!qo(n)))return(r=$t[Wt])===null||r===void 0?void 0:r[t]}function z(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+ot+".");var r=$t[Wt];r&&delete r[t]}var mE,Wt,$t,ft=_(()=>{Wo();_n();Xo();mE=ot.split(".")[0],Wt=Symbol.for("opentelemetry.js.api."+mE),$t=Fo});function qt(t,e,r){var n=V("diag");if(n)return r.unshift(e),n[t].apply(n,hE([],RE(r),!1))}var RE,hE,zo,Qo=_(()=>{ft();RE=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(i){a={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},hE=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},zo=function(){function t(e){this._namespace=e.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return qt("debug",this._namespace,e)},t.prototype.error=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return qt("error",this._namespace,e)},t.prototype.info=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return qt("info",this._namespace,e)},t.prototype.warn=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return qt("warn",this._namespace,e)},t.prototype.verbose=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return qt("verbose",this._namespace,e)},t}()});var d,Be=_(()=>{(function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"})(d||(d={}))});function Jo(t,e){t<d.NONE?t=d.NONE:t>d.ALL&&(t=d.ALL),e=e||{};function r(n,o){var s=e[n];return typeof s=="function"&&t>=o?s.bind(e):function(){}}return{error:r("error",d.ERROR),warn:r("warn",d.WARN),info:r("info",d.INFO),debug:r("debug",d.DEBUG),verbose:r("verbose",d.VERBOSE)}}var Zo=_(()=>{Be()});var NE,OE,ME,P,dt=_(()=>{Qo();Zo();Be();ft();NE=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(i){a={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},OE=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},ME="diag",P=function(){function t(){function e(o){return function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];var i=V("diag");if(i)return i[o].apply(i,OE([],NE(s),!1))}}var r=this,n=function(o,s){var a,i,c;if(s===void 0&&(s={logLevel:d.INFO}),o===r){var E=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error((a=E.stack)!==null&&a!==void 0?a:E.message),!1}typeof s=="number"&&(s={logLevel:s});var S=V("diag"),u=Jo((i=s.logLevel)!==null&&i!==void 0?i:d.INFO,o);if(S&&!s.suppressOverrideMessage){var A=(c=new Error().stack)!==null&&c!==void 0?c:"<failed to generate stacktrace>";S.warn("Current logger will be overwritten from "+A),u.warn("Current logger will overwrite one already registered from "+A)}return X("diag",u,r,!0)};r.setLogger=n,r.disable=function(){z(ME,r)},r.createComponentLogger=function(o){return new zo(o)},r.verbose=e("verbose"),r.debug=e("debug"),r.info=e("info"),r.warn=e("warn"),r.error=e("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}()});var CE,PE,ts,es=_(()=>{CE=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(i){a={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},PE=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ts=function(){function t(e){this._entries=e?new Map(e):new Map}return t.prototype.getEntry=function(e){var r=this._entries.get(e);if(r)return Object.assign({},r)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var r=CE(e,2),n=r[0],o=r[1];return[n,o]})},t.prototype.setEntry=function(e,r){var n=new t(this._entries);return n._entries.set(e,r),n},t.prototype.removeEntry=function(e){var r=new t(this._entries);return r._entries.delete(e),r},t.prototype.removeEntries=function(){for(var e,r,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var s=new t(this._entries);try{for(var a=PE(n),i=a.next();!i.done;i=a.next()){var c=i.value;s._entries.delete(c)}}catch(E){e={error:E}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return s},t.prototype.clear=function(){return new t},t}()});var rs,ns=_(()=>{rs=Symbol("BaggageEntryMetadata")});function os(t){return t===void 0&&(t={}),new ts(new Map(Object.entries(t)))}function Ge(t){return typeof t!="string"&&(gE.error("Cannot create baggage metadata from unknown type: "+typeof t),t=""),{__TYPE__:rs,toString:function(){return t}}}var gE,En=_(()=>{dt();es();ns();gE=P.instance()});function Q(t){return Symbol.for(t)}var xE,He,Xt=_(()=>{xE=function(){function t(e){var r=this;r._currentContext=e?new Map(e):new Map,r.getValue=function(n){return r._currentContext.get(n)},r.setValue=function(n,o){var s=new t(r._currentContext);return s._currentContext.set(n,o),s},r.deleteValue=function(n){var o=new t(r._currentContext);return o._currentContext.delete(n),o}}return t}(),He=new xE});var Sn,ss,is=_(()=>{Sn=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],ss=function(){function t(){function e(n){return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];if(console){var a=console[n];if(typeof a!="function"&&(a=console.log),typeof a=="function")return a.apply(console,o)}}}for(var r=0;r<Sn.length;r++)this[Sn[r].n]=e(Sn[r].c)}return t}()});function as(){return pn}var mt,LE,Ye,IE,DE,UE,yE,Tn,bE,VE,vE,pn,wE,BE,GE,HE,YE,kE,FE,un=_(()=>{mt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),LE=function(){function t(){}return t.prototype.createGauge=function(e,r){return BE},t.prototype.createHistogram=function(e,r){return GE},t.prototype.createCounter=function(e,r){return wE},t.prototype.createUpDownCounter=function(e,r){return HE},t.prototype.createObservableGauge=function(e,r){return kE},t.prototype.createObservableCounter=function(e,r){return YE},t.prototype.createObservableUpDownCounter=function(e,r){return FE},t.prototype.addBatchObservableCallback=function(e,r){},t.prototype.removeBatchObservableCallback=function(e){},t}(),Ye=function(){function t(){}return t}(),IE=function(t){mt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(r,n){},e}(Ye),DE=function(t){mt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(r,n){},e}(Ye),UE=function(t){mt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(r,n){},e}(Ye),yE=function(t){mt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(r,n){},e}(Ye),Tn=function(){function t(){}return t.prototype.addCallback=function(e){},t.prototype.removeCallback=function(e){},t}(),bE=function(t){mt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(Tn),VE=function(t){mt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(Tn),vE=function(t){mt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(Tn),pn=new LE,wE=new IE,BE=new UE,GE=new yE,HE=new DE,YE=new bE,kE=new VE,FE=new vE});var ke,cs=_(()=>{(function(t){t[t.INT=0]="INT",t[t.DOUBLE=1]="DOUBLE"})(ke||(ke={}))});var Fe,Ke,An=_(()=>{Fe={get:function(t,e){if(t!=null)return t[e]},keys:function(t){return t==null?[]:Object.keys(t)}},Ke={set:function(t,e,r){t!=null&&(t[e]=r)}}});var KE,jE,_s,Es=_(()=>{Xt();KE=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(i){a={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},jE=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},_s=function(){function t(){}return t.prototype.active=function(){return He},t.prototype.with=function(e,r,n){for(var o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return r.call.apply(r,jE([n],KE(o),!1))},t.prototype.bind=function(e,r){return r},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}()});var WE,$E,ln,qE,ct,zt=_(()=>{Es();ft();dt();WE=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(i){a={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},$E=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},ln="context",qE=new _s,ct=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(e){return X(ln,e,P.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(e,r,n){for(var o,s=[],a=3;a<arguments.length;a++)s[a-3]=arguments[a];return(o=this._getContextManager()).with.apply(o,$E([e,r,n],WE(s),!1))},t.prototype.bind=function(e,r){return this._getContextManager().bind(e,r)},t.prototype._getContextManager=function(){return V(ln)||qE},t.prototype.disable=function(){this._getContextManager().disable(),z(ln,P.instance())},t}()});var h,fn=_(()=>{(function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"})(h||(h={}))});var Qt,Jt,Lt,je=_(()=>{fn();Qt="0000000000000000",Jt="00000000000000000000000000000000",Lt={traceId:Jt,spanId:Qt,traceFlags:h.NONE}});var _t,We=_(()=>{je();_t=function(){function t(e){e===void 0&&(e=Lt),this._spanContext=e}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,r){return this},t.prototype.setAttributes=function(e){return this},t.prototype.addEvent=function(e,r){return this},t.prototype.addLink=function(e){return this},t.prototype.addLinks=function(e){return this},t.prototype.setStatus=function(e){return this},t.prototype.updateName=function(e){return this},t.prototype.end=function(e){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(e,r){},t}()});function $e(t){return t.getValue(dn)||void 0}function Ss(){return $e(ct.getInstance().active())}function Zt(t,e){return t.setValue(dn,e)}function Ts(t){return t.deleteValue(dn)}function ps(t,e){return Zt(t,new _t(e))}function qe(t){var e;return(e=$e(t))===null||e===void 0?void 0:e.spanContext()}var dn,mn=_(()=>{Xt();We();zt();dn=Q("OpenTelemetry Context Key SPAN")});function te(t){return XE.test(t)&&t!==Jt}function Rn(t){return zE.test(t)&&t!==Qt}function J(t){return te(t.traceId)&&Rn(t.spanId)}function us(t){return new _t(t)}var XE,zE,Xe=_(()=>{je();We();XE=/^([0-9a-f]{32})$/i,zE=/^[0-9a-f]{16}$/i});function QE(t){return typeof t=="object"&&typeof t.spanId=="string"&&typeof t.traceId=="string"&&typeof t.traceFlags=="number"}var hn,ze,Nn=_(()=>{zt();mn();We();Xe();hn=ct.getInstance(),ze=function(){function t(){}return t.prototype.startSpan=function(e,r,n){n===void 0&&(n=hn.active());var o=!!(r!=null&&r.root);if(o)return new _t;var s=n&&qe(n);return QE(s)&&J(s)?new _t(s):new _t},t.prototype.startActiveSpan=function(e,r,n,o){var s,a,i;if(!(arguments.length<2)){arguments.length===2?i=r:arguments.length===3?(s=r,i=n):(s=r,a=n,i=o);var c=a??hn.active(),E=this.startSpan(e,s,c),S=Zt(c,E);return hn.with(S,i,void 0,E)}},t}()});var JE,Qe,On=_(()=>{Nn();JE=new ze,Qe=function(){function t(e,r,n,o){this._provider=e,this.name=r,this.version=n,this.options=o}return t.prototype.startSpan=function(e,r,n){return this._getTracer().startSpan(e,r,n)},t.prototype.startActiveSpan=function(e,r,n,o){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):JE},t}()});var As,ls=_(()=>{Nn();As=function(){function t(){}return t.prototype.getTracer=function(e,r,n){return new ze},t}()});var ZE,ee,Mn=_(()=>{On();ls();ZE=new As,ee=function(){function t(){}return t.prototype.getTracer=function(e,r,n){var o;return(o=this.getDelegateTracer(e,r,n))!==null&&o!==void 0?o:new Qe(this,e,r,n)},t.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:ZE},t.prototype.setDelegate=function(e){this._delegate=e},t.prototype.getDelegateTracer=function(e,r,n){var o;return(o=this._delegate)===null||o===void 0?void 0:o.getTracer(e,r,n)},t}()});var Rt,fs=_(()=>{(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(Rt||(Rt={}))});var It,ds=_(()=>{(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(It||(It={}))});var Et,ms=_(()=>{(function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"})(Et||(Et={}))});function Rs(t){return rS.test(t)}function hs(t){return nS.test(t)&&!oS.test(t)}var Cn,tS,eS,rS,nS,oS,Ns=_(()=>{Cn="[_0-9a-z-*/]",tS="[a-z]"+Cn+"{0,255}",eS="[a-z0-9]"+Cn+"{0,240}@[a-z]"+Cn+"{0,13}",rS=new RegExp("^(?:"+tS+"|"+eS+")$"),nS=/^[ -~]{0,255}[!-~]$/,oS=/,|=/});var Os,sS,Ms,Cs,Ps,gs=_(()=>{Ns();Os=32,sS=512,Ms=",",Cs="=",Ps=function(){function t(e){this._internalState=new Map,e&&this._parse(e)}return t.prototype.set=function(e,r){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,r),n},t.prototype.unset=function(e){var r=this._clone();return r._internalState.delete(e),r},t.prototype.get=function(e){return this._internalState.get(e)},t.prototype.serialize=function(){var e=this;return this._keys().reduce(function(r,n){return r.push(n+Cs+e.get(n)),r},[]).join(Ms)},t.prototype._parse=function(e){e.length>sS||(this._internalState=e.split(Ms).reverse().reduce(function(r,n){var o=n.trim(),s=o.indexOf(Cs);if(s!==-1){var a=o.slice(0,s),i=o.slice(s+1,n.length);Rs(a)&&hs(i)&&r.set(a,i)}return r},new Map),this._internalState.size>Os&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,Os))))},t.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},t.prototype._clone=function(){var e=new t;return e._internalState=new Map(this._internalState),e},t}()});function xs(t){return new Ps(t)}var Ls=_(()=>{gs()});var I,Is=_(()=>{zt();I=ct.getInstance()});var T,Ds=_(()=>{dt();T=P.instance()});var iS,Us,ys=_(()=>{un();iS=function(){function t(){}return t.prototype.getMeter=function(e,r,n){return pn},t}(),Us=new iS});var Pn,bs,Vs=_(()=>{ys();ft();dt();Pn="metrics",bs=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalMeterProvider=function(e){return X(Pn,e,P.instance())},t.prototype.getMeterProvider=function(){return V(Pn)||Us},t.prototype.getMeter=function(e,r,n){return this.getMeterProvider().getMeter(e,r,n)},t.prototype.disable=function(){z(Pn,P.instance())},t}()});var gn,vs=_(()=>{Vs();gn=bs.getInstance()});var ws,Bs=_(()=>{ws=function(){function t(){}return t.prototype.inject=function(e,r){},t.prototype.extract=function(e,r){return e},t.prototype.fields=function(){return[]},t}()});function Ln(t){return t.getValue(xn)||void 0}function Gs(){return Ln(ct.getInstance().active())}function Hs(t,e){return t.setValue(xn,e)}function Ys(t){return t.deleteValue(xn)}var xn,ks=_(()=>{zt();Xt();xn=Q("OpenTelemetry Baggage Key")});var In,aS,Fs,Ks=_(()=>{ft();Bs();An();ks();En();dt();In="propagation",aS=new ws,Fs=function(){function t(){this.createBaggage=os,this.getBaggage=Ln,this.getActiveBaggage=Gs,this.setBaggage=Hs,this.deleteBaggage=Ys}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(e){return X(In,e,P.instance())},t.prototype.inject=function(e,r,n){return n===void 0&&(n=Ke),this._getGlobalPropagator().inject(e,r,n)},t.prototype.extract=function(e,r,n){return n===void 0&&(n=Fe),this._getGlobalPropagator().extract(e,r,n)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){z(In,P.instance())},t.prototype._getGlobalPropagator=function(){return V(In)||aS},t}()});var ht,js=_(()=>{Ks();ht=Fs.getInstance()});var Dn,Ws,$s=_(()=>{ft();Mn();Xe();mn();dt();Dn="trace",Ws=function(){function t(){this._proxyTracerProvider=new ee,this.wrapSpanContext=us,this.isSpanContextValid=J,this.deleteSpan=Ts,this.getSpan=$e,this.getActiveSpan=Ss,this.getSpanContext=qe,this.setSpan=Zt,this.setSpanContext=ps}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(e){var r=X(Dn,this._proxyTracerProvider,P.instance());return r&&this._proxyTracerProvider.setDelegate(e),r},t.prototype.getTracerProvider=function(){return V(Dn)||this._proxyTracerProvider},t.prototype.getTracer=function(e,r){return this.getTracerProvider().getTracer(e,r)},t.prototype.disable=function(){z(Dn,P.instance()),this._proxyTracerProvider=new ee},t}()});var D,qs=_(()=>{$s();D=Ws.getInstance()});var Nt={};q(Nt,{DiagConsoleLogger:()=>ss,DiagLogLevel:()=>d,INVALID_SPANID:()=>Qt,INVALID_SPAN_CONTEXT:()=>Lt,INVALID_TRACEID:()=>Jt,ProxyTracer:()=>Qe,ProxyTracerProvider:()=>ee,ROOT_CONTEXT:()=>He,SamplingDecision:()=>Rt,SpanKind:()=>It,SpanStatusCode:()=>Et,TraceFlags:()=>h,ValueType:()=>ke,baggageEntryMetadataFromString:()=>Ge,context:()=>I,createContextKey:()=>Q,createNoopMeter:()=>as,createTraceState:()=>xs,default:()=>cS,defaultTextMapGetter:()=>Fe,defaultTextMapSetter:()=>Ke,diag:()=>T,isSpanContextValid:()=>J,isValidSpanId:()=>Rn,isValidTraceId:()=>te,metrics:()=>gn,propagation:()=>ht,trace:()=>D});var cS,p=_(()=>{En();Xt();is();Be();un();cs();An();On();Mn();fs();ds();ms();fn();Ls();Xe();je();Is();Ds();vs();js();qs();cS={context:I,diag:T,metrics:gn,propagation:ht,trace:D}});function Dt(t){return t.setValue(Un,!0)}function Xs(t){return t.deleteValue(Un)}function St(t){return t.getValue(Un)===!0}var Un,re=_(()=>{p();Un=Q("OpenTelemetry SDK Context Key SUPPRESS_TRACING")});var zs,Je,Ut,Ze,yn=_(()=>{zs="=",Je=";",Ut=",",Ze="baggage"});function Qs(t){return t.reduce((e,r)=>{let n=`${e}${e!==""?Ut:""}${r}`;return n.length>8192?e:n},"")}function Js(t){return t.getAllEntries().map(([e,r])=>{let n=`${encodeURIComponent(e)}=${encodeURIComponent(r.value)}`;return r.metadata!==void 0&&(n+=Je+r.metadata.toString()),n})}function bn(t){let e=t.split(Je);if(e.length<=0)return;let r=e.shift();if(!r)return;let n=r.indexOf(zs);if(n<=0)return;let o=decodeURIComponent(r.substring(0,n).trim()),s=decodeURIComponent(r.substring(n+1).trim()),a;return e.length>0&&(a=Ge(e.join(Je))),{key:o,value:s,metadata:a}}function Zs(t){return typeof t!="string"||t.length===0?{}:t.split(Ut).map(e=>bn(e)).filter(e=>e!==void 0&&e.value.length>0).reduce((e,r)=>(e[r.key]=r.value,e),{})}var Vn=_(()=>{p();yn()});var tr,ti=_(()=>{p();re();yn();Vn();tr=class{inject(e,r,n){let o=ht.getBaggage(e);if(!o||St(e))return;let s=Js(o).filter(i=>i.length<=4096).slice(0,180),a=Qs(s);a.length>0&&n.set(r,Ze,a)}extract(e,r,n){let o=n.get(r,Ze),s=Array.isArray(o)?o.join(Ut):o;if(!s)return e;let a={};return s.length===0||(s.split(Ut).forEach(c=>{let E=bn(c);if(E){let S={value:E.value};E.metadata&&(S.metadata=E.metadata),a[E.key]=S}}),Object.entries(a).length===0)?e:ht.setBaggage(e,ht.createBaggage(a))}fields(){return[Ze]}}});var er,ei=_(()=>{er=class{_monotonicClock;_epochMillis;_performanceMillis;constructor(e,r){this._monotonicClock=r,this._epochMillis=e.now(),this._performanceMillis=r.now()}now(){let e=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+e}}});function Tt(t){let e={};if(typeof t!="object"||t==null)return e;for(let[r,n]of Object.entries(t)){if(!TS(r)){T.warn(`Invalid attribute key: ${r}`);continue}if(!ne(n)){T.warn(`Invalid attribute value set for key: ${r}`);continue}Array.isArray(n)?e[r]=n.slice():e[r]=n}return e}function TS(t){return typeof t=="string"&&t.length>0}function ne(t){return t==null?!0:Array.isArray(t)?pS(t):ri(t)}function pS(t){let e;for(let r of t)if(r!=null){if(!e){if(ri(r)){e=typeof r;continue}return!1}if(typeof r!==e)return!1}return!0}function ri(t){switch(typeof t){case"number":case"boolean":case"string":return!0}return!1}var ni=_(()=>{p()});function rr(){return t=>{T.error(uS(t))}}function uS(t){return typeof t=="string"?t:JSON.stringify(AS(t))}function AS(t){let e={},r=t;for(;r!==null;)Object.getOwnPropertyNames(r).forEach(n=>{if(e[n])return;let o=r[n];o&&(e[n]=String(o))}),r=Object.getPrototypeOf(r);return e}var vn=_(()=>{p()});function si(t){oi=t}function F(t){try{oi(t)}catch{}}var oi,ii=_(()=>{vn();oi=rr()});import{inspect as ai}from"util";function m(t){let e=process.env[t];if(e==null||e.trim()==="")return;let r=Number(e);if(isNaN(r)){T.warn(`Unknown value ${ai(e)} for ${t}, expected a number, using defaults`);return}return r}function Z(t){let e=process.env[t];if(!(e==null||e.trim()===""))return e}function nr(t){var r;let e=(r=process.env[t])==null?void 0:r.trim().toLowerCase();return e==null||e===""?!1:e==="true"?!0:(e==="false"||T.warn(`Unknown value ${ai(e)} for ${t}, expected 'true' or 'false', falling back to 'false' (default)`),!1)}function or(t){var e;return(e=Z(t))==null?void 0:e.split(",").map(r=>r.trim()).filter(r=>r!=="")}var ci=_(()=>{p()});var sr,_i=_(()=>{sr=typeof globalThis=="object"?globalThis:global});import{performance as lS}from"perf_hooks";var v,Ei=_(()=>{v=lS});var Si,Ti=_(()=>{Si="2.0.0"});var fS,dS,mS,ir,ar,pi,ui=_(()=>{fS="exception.type",dS="exception.message",mS="exception.stacktrace",ir=fS,ar=dS,pi=mS});var Ai=_(()=>{ui()});var RS,hS,NS,OS,MS,CS,PS,gS,xS,LS,IS,DS,US,yS,bS,VS,vS,wS,BS,li,fi,di,mi,Ri,hi,Ni,Oi,Mi,Ci,Pi,cr,gi,xi,Li,Ii,Di,Ui,yi,GS,bi,Vi=_(()=>{RS="host.id",hS="host.name",NS="host.arch",OS="os.type",MS="os.version",CS="process.pid",PS="process.executable.name",gS="process.executable.path",xS="process.command",LS="process.command_args",IS="process.owner",DS="process.runtime.name",US="process.runtime.version",yS="process.runtime.description",bS="service.name",VS="service.instance.id",vS="telemetry.sdk.name",wS="telemetry.sdk.language",BS="telemetry.sdk.version",li=RS,fi=hS,di=NS,mi=OS,Ri=MS,hi=CS,Ni=PS,Oi=gS,Mi=xS,Ci=LS,Pi=IS,cr=DS,gi=US,xi=yS,Li=bS,Ii=VS,Di=vS,Ui=wS,yi=BS,GS="nodejs",bi=GS});var vi=_(()=>{Vi()});var wi,wn,Bn,Gn,Bi=_(()=>{wi="service.name",wn="telemetry.sdk.language",Bn="telemetry.sdk.name",Gn="telemetry.sdk.version"});var Gi=_(()=>{});var st=_(()=>{Ai();vi();Bi();Gi()});var pt,Hi=_(()=>{Ti();st();pt={[Di]:"opentelemetry",[cr]:"node",[Ui]:bi,[yi]:Si}});function yt(t){t.unref()}var Yi=_(()=>{});var ki=_(()=>{ci();_i();Ei();Hi();Yi()});var Hn=_(()=>{ki()});function K(t){let e=t/1e3,r=Math.trunc(e),n=Math.round(t%1e3*YS);return[r,n]}function bt(){let t=v.timeOrigin;if(typeof t!="number"){let e=v;t=e.timing&&e.timing.fetchStart}return t}function oe(t){let e=K(bt()),r=K(typeof t=="number"?t:v.now());return ae(e,r)}function Ki(t){if(Vt(t))return t;if(typeof t=="number")return t<bt()?oe(t):K(t);if(t instanceof Date)return K(t.getTime());throw TypeError("Invalid input type")}function Er(t,e){let r=e[0]-t[0],n=e[1]-t[1];return n<0&&(r-=1,n+=_r),[r,n]}function ji(t){let e=Fi,r=`${"0".repeat(e)}${t[1]}Z`,n=r.substring(r.length-e-1);return new Date(t[0]*1e3).toISOString().replace("000Z",n)}function Sr(t){return t[0]*_r+t[1]}function Wi(t){return t[0]*1e3+t[1]/1e6}function se(t){return t[0]*1e6+t[1]/1e3}function Vt(t){return Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"}function ie(t){return Vt(t)||typeof t=="number"||t instanceof Date}function ae(t,e){let r=[t[0]+e[0],t[1]+e[1]];return r[1]>=_r&&(r[1]-=_r,r[0]+=1),r}var Fi,HS,YS,_r,$i=_(()=>{Hn();Fi=9,HS=6,YS=Math.pow(10,HS),_r=Math.pow(10,Fi)});var g,qi=_(()=>{(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"})(g||(g={}))});var Tr,Xi=_(()=>{p();Tr=class{_propagators;_fields;constructor(e={}){this._propagators=e.propagators??[],this._fields=Array.from(new Set(this._propagators.map(r=>typeof r.fields=="function"?r.fields():[]).reduce((r,n)=>r.concat(n),[])))}inject(e,r,n){for(let o of this._propagators)try{o.inject(e,r,n)}catch(s){T.warn(`Failed to inject with ${o.constructor.name}. Err: ${s.message}`)}}extract(e,r,n){return this._propagators.reduce((o,s)=>{try{return s.extract(o,r,n)}catch(a){T.warn(`Failed to extract with ${s.constructor.name}. Err: ${a.message}`)}return o},e)}fields(){return this._fields.slice()}}});function zi(t){return KS.test(t)}function Qi(t){return jS.test(t)&&!WS.test(t)}var Yn,kS,FS,KS,jS,WS,Ji=_(()=>{Yn="[_0-9a-z-*/]",kS=`[a-z]${Yn}{0,255}`,FS=`[a-z0-9]${Yn}{0,240}@[a-z]${Yn}{0,13}`,KS=new RegExp(`^(?:${kS}|${FS})$`),jS=/^[ -~]{0,255}[!-~]$/,WS=/,|=/});var Zi,$S,ta,ea,vt,kn=_(()=>{Ji();Zi=32,$S=512,ta=",",ea="=",vt=class t{_internalState=new Map;constructor(e){e&&this._parse(e)}set(e,r){let n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,r),n}unset(e){let r=this._clone();return r._internalState.delete(e),r}get(e){return this._internalState.get(e)}serialize(){return this._keys().reduce((e,r)=>(e.push(r+ea+this.get(r)),e),[]).join(ta)}_parse(e){e.length>$S||(this._internalState=e.split(ta).reverse().reduce((r,n)=>{let o=n.trim(),s=o.indexOf(ea);if(s!==-1){let a=o.slice(0,s),i=o.slice(s+1,n.length);zi(a)&&Qi(i)&&r.set(a,i)}return r},new Map),this._internalState.size>Zi&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,Zi))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){let e=new t;return e._internalState=new Map(this._internalState),e}}});function Fn(t){let e=ZS.exec(t);return!e||e[1]==="00"&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}}var ce,_e,qS,XS,zS,QS,JS,ZS,pr,ra=_(()=>{p();re();kn();ce="traceparent",_e="tracestate",qS="00",XS="(?!ff)[\\da-f]{2}",zS="(?![0]{32})[\\da-f]{32}",QS="(?![0]{16})[\\da-f]{16}",JS="[\\da-f]{2}",ZS=new RegExp(`^\\s?(${XS})-(${zS})-(${QS})-(${JS})(-.*)?\\s?$`);pr=class{inject(e,r,n){let o=D.getSpanContext(e);if(!o||St(e)||!J(o))return;let s=`${qS}-${o.traceId}-${o.spanId}-0${Number(o.traceFlags||h.NONE).toString(16)}`;n.set(r,ce,s),o.traceState&&n.set(r,_e,o.traceState.serialize())}extract(e,r,n){let o=n.get(r,ce);if(!o)return e;let s=Array.isArray(o)?o[0]:o;if(typeof s!="string")return e;let a=Fn(s);if(!a)return e;a.isRemote=!0;let i=n.get(r,_e);if(i){let c=Array.isArray(i)?i.join(","):i;a.traceState=new vt(typeof c=="string"?c:void 0)}return D.setSpanContext(e,a)}fields(){return[ce,_e]}}});function na(t,e){return t.setValue(Kn,e)}function oa(t){return t.deleteValue(Kn)}function sa(t){return t.getValue(Kn)}var Kn,ur,ia=_(()=>{p();Kn=Q("OpenTelemetry SDK Context Key RPC_METADATA");(function(t){t.HTTP="http"})(ur||(ur={}))});function jn(t){if(!iT(t)||aT(t)!==tT)return!1;let e=sT(t);if(e===null)return!0;let r=_a.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&aa.call(r)===oT}function iT(t){return t!=null&&typeof t=="object"}function aT(t){return t==null?t===void 0?rT:eT:Ot&&Ot in Object(t)?cT(t):_T(t)}function cT(t){let e=_a.call(t,Ot),r=t[Ot],n=!1;try{t[Ot]=void 0,n=!0}catch{}let o=Ea.call(t);return n&&(e?t[Ot]=r:delete t[Ot]),o}function _T(t){return Ea.call(t)}var tT,eT,rT,nT,aa,oT,sT,ca,_a,Ot,Ea,Sa=_(()=>{tT="[object Object]",eT="[object Null]",rT="[object Undefined]",nT=Function.prototype,aa=nT.toString,oT=aa.call(Object),sT=Object.getPrototypeOf,ca=Object.prototype,_a=ca.hasOwnProperty,Ot=Symbol?Symbol.toStringTag:void 0,Ea=ca.toString});function fr(...t){let e=t.shift(),r=new WeakMap;for(;t.length>0;)e=pa(e,t.shift(),0,r);return e}function Wn(t){return lr(t)?t.slice():t}function pa(t,e,r=0,n){let o;if(!(r>ET)){if(r++,Ar(t)||Ar(e)||ua(e))o=Wn(e);else if(lr(t)){if(o=t.slice(),lr(e))for(let s=0,a=e.length;s<a;s++)o.push(Wn(e[s]));else if(Ee(e)){let s=Object.keys(e);for(let a=0,i=s.length;a<i;a++){let c=s[a];o[c]=Wn(e[c])}}}else if(Ee(t))if(Ee(e)){if(!ST(t,e))return e;o=Object.assign({},t);let s=Object.keys(e);for(let a=0,i=s.length;a<i;a++){let c=s[a],E=e[c];if(Ar(E))typeof E>"u"?delete o[c]:o[c]=E;else{let S=o[c],u=E;if(Ta(t,c,n)||Ta(e,c,n))delete o[c];else{if(Ee(S)&&Ee(u)){let A=n.get(S)||[],R=n.get(u)||[];A.push({obj:t,key:c}),R.push({obj:e,key:c}),n.set(S,A),n.set(u,R)}o[c]=pa(o[c],E,r,n)}}}}else o=e;return o}}function Ta(t,e,r){let n=r.get(t[e])||[];for(let o=0,s=n.length;o<s;o++){let a=n[o];if(a.key===e&&a.obj===t)return!0}return!1}function lr(t){return Array.isArray(t)}function ua(t){return typeof t=="function"}function Ee(t){return!Ar(t)&&!lr(t)&&!ua(t)&&typeof t=="object"}function Ar(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t>"u"||t instanceof Date||t instanceof RegExp||t===null}function ST(t,e){return!(!jn(t)||!jn(e))}var ET,Aa=_(()=>{Sa();ET=20});function la(t,e){let r,n=new Promise(function(s,a){r=setTimeout(function(){a(new Se("Operation timed out."))},e)});return Promise.race([t,n]).then(o=>(clearTimeout(r),o),o=>{throw clearTimeout(r),o})}var Se,fa=_(()=>{Se=class t extends Error{constructor(e){super(e),Object.setPrototypeOf(this,t.prototype)}}});function $n(t,e){return typeof e=="string"?t===e:!!t.match(e)}function da(t,e){if(!e)return!1;for(let r of e)if($n(t,r))return!0;return!1}var ma=_(()=>{});var dr,Ra=_(()=>{dr=class{_promise;_resolve;_reject;constructor(){this._promise=new Promise((e,r)=>{this._resolve=e,this._reject=r})}get promise(){return this._promise}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}});var tt,ha=_(()=>{Ra();tt=class{_callback;_that;_isCalled=!1;_deferred=new dr;constructor(e,r){this._callback=e,this._that=r}get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...e){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...e)).then(r=>this._deferred.resolve(r),r=>this._deferred.reject(r))}catch(r){this._deferred.reject(r)}}return this._deferred.promise}}});function Oa(t){if(t==null)return;let e=Na[t.toUpperCase()];return e??(T.warn(`Unknown log level "${t}", expected one of ${Object.keys(Na)}, using default`),d.INFO)}var Na,Ma=_(()=>{p();Na={ALL:d.ALL,VERBOSE:d.VERBOSE,DEBUG:d.DEBUG,INFO:d.INFO,WARN:d.WARN,ERROR:d.ERROR,NONE:d.NONE}});function Ca(t,e){return new Promise(r=>{I.with(Dt(I.active()),()=>{t.export(e,n=>{r(n)})})})}var Pa=_(()=>{p();re()});var ga={};q(ga,{AnchoredClock:()=>er,BindOnceFuture:()=>tt,CompositePropagator:()=>Tr,ExportResultCode:()=>g,RPCType:()=>ur,SDK_INFO:()=>pt,TRACE_PARENT_HEADER:()=>ce,TRACE_STATE_HEADER:()=>_e,TimeoutError:()=>Se,TraceState:()=>vt,W3CBaggagePropagator:()=>tr,W3CTraceContextPropagator:()=>pr,_globalThis:()=>sr,addHrTimes:()=>ae,callWithTimeout:()=>la,deleteRPCMetadata:()=>oa,diagLogLevelFromString:()=>Oa,getBooleanFromEnv:()=>nr,getNumberFromEnv:()=>m,getRPCMetadata:()=>sa,getStringFromEnv:()=>Z,getStringListFromEnv:()=>or,getTimeOrigin:()=>bt,globalErrorHandler:()=>F,hrTime:()=>oe,hrTimeDuration:()=>Er,hrTimeToMicroseconds:()=>se,hrTimeToMilliseconds:()=>Wi,hrTimeToNanoseconds:()=>Sr,hrTimeToTimeStamp:()=>ji,internal:()=>qn,isAttributeValue:()=>ne,isTimeInput:()=>ie,isTimeInputHrTime:()=>Vt,isTracingSuppressed:()=>St,isUrlIgnored:()=>da,loggingErrorHandler:()=>rr,merge:()=>fr,millisToHrTime:()=>K,otperformance:()=>v,parseKeyPairsIntoRecord:()=>Zs,parseTraceParent:()=>Fn,sanitizeAttributes:()=>Tt,setGlobalErrorHandler:()=>si,setRPCMetadata:()=>na,suppressTracing:()=>Dt,timeInputToHrTime:()=>Ki,unrefTimer:()=>yt,unsuppressTracing:()=>Xs,urlMatches:()=>$n});var qn,O=_(()=>{ti();ei();ni();ii();vn();$i();qi();Vn();Hn();Xi();ra();ia();re();kn();Aa();fa();ma();ha();Ma();Pa();qn={_export:Ca}});function wt(){return`unknown_service:${process.argv0}`}var Ba=_(()=>{});var Ga=_(()=>{Ba()});var Xn=_(()=>{Ga()});var pe,Ha=_(()=>{pe=t=>t!==null&&typeof t=="object"&&typeof t.then=="function"});function hr(t){return Rr.FromAttributeList(Object.entries(t))}function Ya(t){return new Rr(t)}function ue(){return hr({})}function Nr(){return hr({[wi]:wt(),[wn]:pt[wn],[Bn]:pt[Bn],[Gn]:pt[Gn]})}var Rr,zn=_(()=>{p();O();st();Xn();Ha();Rr=class t{_rawAttributes;_asyncAttributesPending=!1;_memoizedAttributes;static FromAttributeList(e){let r=new t({});return r._rawAttributes=e,r._asyncAttributesPending=e.filter(([n,o])=>pe(o)).length>0,r}constructor(e){let r=e.attributes??{};this._rawAttributes=Object.entries(r).map(([n,o])=>(pe(o)&&(this._asyncAttributesPending=!0),[n,o]))}get asyncAttributesPending(){return this._asyncAttributesPending}async waitForAsyncAttributes(){if(this.asyncAttributesPending){for(let e=0;e<this._rawAttributes.length;e++){let[r,n]=this._rawAttributes[e];try{this._rawAttributes[e]=[r,pe(n)?await n:n]}catch(o){T.debug("a resource's async attributes promise rejected: %s",o),this._rawAttributes[e]=[r,void 0]}}this._asyncAttributesPending=!1}}get attributes(){if(this.asyncAttributesPending&&T.error("Accessing resource attributes before async attributes settled"),this._memoizedAttributes)return this._memoizedAttributes;let e={};for(let[r,n]of this._rawAttributes){if(pe(n)){T.debug(`Unsettled resource attribute ${r} skipped`);continue}n!=null&&(e[r]??(e[r]=n))}return this._asyncAttributesPending||(this._memoizedAttributes=e),e}getRawAttributes(){return this._rawAttributes}merge(e){return e==null?this:t.FromAttributeList([...e.getRawAttributes(),...this.getRawAttributes()])}}});var ka,lT,Fa=_(()=>{p();zn();ka=(t={})=>{let e=(t.detectors||[]).map(r=>{try{let n=Ya(r.detect(t));return T.debug(`${r.constructor.name} found resource.`,n),n}catch(n){return T.debug(`${r.constructor.name} failed: ${n.message}`),ue()}});return lT(e),e.reduce((r,n)=>r.merge(n),ue())},lT=t=>{t.forEach(e=>{if(Object.keys(e.attributes).length>0){let r=JSON.stringify(e.attributes,null,4);T.verbose(r)}})}});var Qn,Jn,Ka=_(()=>{p();st();O();Qn=class{_MAX_LENGTH=255;_COMMA_SEPARATOR=",";_LABEL_KEY_VALUE_SPLITTER="=";_ERROR_MESSAGE_INVALID_CHARS="should be a ASCII string with a length greater than 0 and not exceed "+this._MAX_LENGTH+" characters.";_ERROR_MESSAGE_INVALID_VALUE="should be a ASCII string with a length not exceed "+this._MAX_LENGTH+" characters.";detect(e){let r={},n=Z("OTEL_RESOURCE_ATTRIBUTES"),o=Z("OTEL_SERVICE_NAME");if(n)try{let s=this._parseResourceAttributes(n);Object.assign(r,s)}catch(s){T.debug(`EnvDetector failed: ${s.message}`)}return o&&(r[Li]=o),{attributes:r}}_parseResourceAttributes(e){if(!e)return{};let r={},n=e.split(this._COMMA_SEPARATOR,-1);for(let o of n){let s=o.split(this._LABEL_KEY_VALUE_SPLITTER,-1);if(s.length!==2)continue;let[a,i]=s;if(a=a.trim(),i=i.trim().split(/^"|"$/).join(""),!this._isValidAndNotEmpty(a))throw new Error(`Attribute key ${this._ERROR_MESSAGE_INVALID_CHARS}`);if(!this._isValid(i))throw new Error(`Attribute value ${this._ERROR_MESSAGE_INVALID_VALUE}`);r[a]=decodeURIComponent(i)}return r}_isValid(e){return e.length<=this._MAX_LENGTH&&this._isBaggageOctetString(e)}_isBaggageOctetString(e){for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);if(n<33||n===44||n===59||n===92||n>126)return!1}return!0}_isValidAndNotEmpty(e){return e.length>0&&this._isValid(e)}},Jn=new Qn});import*as ja from"child_process";import*as Wa from"util";var Bt,Or=_(()=>{Bt=Wa.promisify(ja.exec)});var $a={};q($a,{getMachineId:()=>fT});async function fT(){try{let e=(await Bt('ioreg -rd1 -c "IOPlatformExpertDevice"')).stdout.split(`
`).find(n=>n.includes("IOPlatformUUID"));if(!e)return;let r=e.split('" = "');if(r.length===2)return r[1].slice(0,-1)}catch(t){T.debug(`error reading machine id: ${t}`)}}var qa=_(()=>{Or();p()});var Xa={};q(Xa,{getMachineId:()=>mT});import{promises as dT}from"fs";async function mT(){let t=["/etc/machine-id","/var/lib/dbus/machine-id"];for(let e of t)try{return(await dT.readFile(e,{encoding:"utf8"})).trim()}catch(r){T.debug(`error reading machine id: ${r}`)}}var za=_(()=>{p()});var Qa={};q(Qa,{getMachineId:()=>hT});import{promises as RT}from"fs";async function hT(){try{return(await RT.readFile("/etc/hostid",{encoding:"utf8"})).trim()}catch(t){T.debug(`error reading machine id: ${t}`)}try{return(await Bt("kenv -q smbios.system.uuid")).stdout.trim()}catch(t){T.debug(`error reading machine id: ${t}`)}}var Ja=_(()=>{Or();p()});var Za={};q(Za,{getMachineId:()=>NT});import*as Mr from"process";async function NT(){let t="QUERY HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography /v MachineGuid",e="%windir%\\System32\\REG.exe";Mr.arch==="ia32"&&"PROCESSOR_ARCHITEW6432"in Mr.env&&(e="%windir%\\sysnative\\cmd.exe /c "+e);try{let n=(await Bt(`${e} ${t}`)).stdout.split("REG_SZ");if(n.length===2)return n[1].trim()}catch(r){T.debug(`error reading machine id: ${r}`)}}var tc=_(()=>{Or();p()});var ec={};q(ec,{getMachineId:()=>OT});async function OT(){T.debug("could not read machine-id: unsupported platform")}var rc=_(()=>{p()});import*as nc from"process";var Mt,oc=_(()=>{switch(nc.platform){case"darwin":({getMachineId:Mt}=(qa(),k($a)));break;case"linux":({getMachineId:Mt}=(za(),k(Xa)));break;case"freebsd":({getMachineId:Mt}=(Ja(),k(Qa)));break;case"win32":({getMachineId:Mt}=(tc(),k(Za)));break;default:({getMachineId:Mt}=(rc(),k(ec)))}});var sc,ic,Zn=_(()=>{sc=t=>{switch(t){case"arm":return"arm32";case"ppc":return"ppc32";case"x64":return"amd64";default:return t}},ic=t=>{switch(t){case"sunos":return"solaris";case"win32":return"windows";default:return t}}});import{arch as MT,hostname as CT}from"os";var to,Ae,ac=_(()=>{st();oc();Zn();to=class{detect(e){return{attributes:{[fi]:CT(),[di]:sc(MT()),[li]:Mt()}}}},Ae=new to});import{platform as PT,release as gT}from"os";var eo,le,cc=_(()=>{st();Zn();eo=class{detect(e){return{attributes:{[mi]:ic(PT()),[Ri]:gT()}}}},le=new eo});import*as _c from"os";var ro,fe,Ec=_(()=>{p();st();ro=class{detect(e){let r={[hi]:process.pid,[Ni]:process.title,[Oi]:process.execPath,[Ci]:[process.argv[0],...process.execArgv,...process.argv.slice(1)],[gi]:process.versions.node,[cr]:"nodejs",[xi]:"Node.js"};process.argv.length>1&&(r[Mi]=process.argv[1]);try{let n=_c.userInfo();r[Pi]=n.username}catch(n){T.debug(`error obtaining process owner: ${n}`)}return{attributes:r}}},fe=new ro});import{randomUUID as xT}from"crypto";var no,de,Sc=_(()=>{st();no=class{detect(e){return{attributes:{[Ii]:xT()}}}},de=new no});var Tc=_(()=>{ac();cc();Ec();Sc()});var pc=_(()=>{Tc()});var uc=_(()=>{Ka();pc()});var Ac={};q(Ac,{defaultResource:()=>Nr,defaultServiceName:()=>wt,detectResources:()=>ka,emptyResource:()=>ue,envDetector:()=>Jn,hostDetector:()=>Ae,osDetector:()=>le,processDetector:()=>fe,resourceFromAttributes:()=>hr,serviceInstanceIdDetector:()=>de});var oo=_(()=>{Fa();uc();zn();Xn()});var io=xt(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Pr.AbstractAsyncHooksContextManager=void 0;var bT=sn("events"),VT=["addListener","on","once","prependListener","prependOnceListener"],so=class{bind(e,r){return r instanceof bT.EventEmitter?this._bindEventEmitter(e,r):typeof r=="function"?this._bindFunction(e,r):r}_bindFunction(e,r){let n=this,o=function(...s){return n.with(e,()=>r.apply(this,s))};return Object.defineProperty(o,"length",{enumerable:!1,configurable:!0,writable:!1,value:r.length}),o}_bindEventEmitter(e,r){return this._getPatchMap(r)!==void 0||(this._createPatchMap(r),VT.forEach(o=>{r[o]!==void 0&&(r[o]=this._patchAddListener(r,r[o],e))}),typeof r.removeListener=="function"&&(r.removeListener=this._patchRemoveListener(r,r.removeListener)),typeof r.off=="function"&&(r.off=this._patchRemoveListener(r,r.off)),typeof r.removeAllListeners=="function"&&(r.removeAllListeners=this._patchRemoveAllListeners(r,r.removeAllListeners))),r}_patchRemoveListener(e,r){let n=this;return function(o,s){var c;let a=(c=n._getPatchMap(e))==null?void 0:c[o];if(a===void 0)return r.call(this,o,s);let i=a.get(s);return r.call(this,o,i||s)}}_patchRemoveAllListeners(e,r){let n=this;return function(o){let s=n._getPatchMap(e);return s!==void 0&&(arguments.length===0?n._createPatchMap(e):s[o]!==void 0&&delete s[o]),r.apply(this,arguments)}}_patchAddListener(e,r,n){let o=this;return function(s,a){if(o._wrapped)return r.call(this,s,a);let i=o._getPatchMap(e);i===void 0&&(i=o._createPatchMap(e));let c=i[s];c===void 0&&(c=new WeakMap,i[s]=c);let E=o.bind(n,a);c.set(a,E),o._wrapped=!0;try{return r.call(this,s,E)}finally{o._wrapped=!1}}}_createPatchMap(e){let r=Object.create(null);return e[this._kOtListeners]=r,r}_getPatchMap(e){return e[this._kOtListeners]}_kOtListeners=Symbol("OtListeners");_wrapped=!1};Pr.AbstractAsyncHooksContextManager=so});var fc=xt(gr=>{"use strict";Object.defineProperty(gr,"__esModule",{value:!0});gr.AsyncHooksContextManager=void 0;var vT=(p(),k(Nt)),wT=sn("async_hooks"),BT=io(),ao=class extends BT.AbstractAsyncHooksContextManager{_asyncHook;_contexts=new Map;_stack=[];constructor(){super(),this._asyncHook=wT.createHook({init:this._init.bind(this),before:this._before.bind(this),after:this._after.bind(this),destroy:this._destroy.bind(this),promiseResolve:this._destroy.bind(this)})}active(){return this._stack[this._stack.length-1]??vT.ROOT_CONTEXT}with(e,r,n,...o){this._enterContext(e);try{return r.call(n,...o)}finally{this._exitContext()}}enable(){return this._asyncHook.enable(),this}disable(){return this._asyncHook.disable(),this._contexts.clear(),this._stack=[],this}_init(e,r){if(r==="TIMERWRAP")return;let n=this._stack[this._stack.length-1];n!==void 0&&this._contexts.set(e,n)}_destroy(e){this._contexts.delete(e)}_before(e){let r=this._contexts.get(e);r!==void 0&&this._enterContext(r)}_after(){this._exitContext()}_enterContext(e){this._stack.push(e)}_exitContext(){this._stack.pop()}};gr.AsyncHooksContextManager=ao});var dc=xt(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.AsyncLocalStorageContextManager=void 0;var GT=(p(),k(Nt)),HT=sn("async_hooks"),YT=io(),co=class extends YT.AbstractAsyncHooksContextManager{_asyncLocalStorage;constructor(){super(),this._asyncLocalStorage=new HT.AsyncLocalStorage}active(){return this._asyncLocalStorage.getStore()??GT.ROOT_CONTEXT}with(e,r,n,...o){let s=n==null?r:r.bind(n);return this._asyncLocalStorage.run(e,s,...o)}enable(){return this}disable(){return this._asyncLocalStorage.disable(),this}};xr.AsyncLocalStorageContextManager=co});var mc=xt(Gt=>{"use strict";Object.defineProperty(Gt,"__esModule",{value:!0});Gt.AsyncLocalStorageContextManager=Gt.AsyncHooksContextManager=void 0;var kT=fc();Object.defineProperty(Gt,"AsyncHooksContextManager",{enumerable:!0,get:function(){return kT.AsyncHooksContextManager}});var FT=dc();Object.defineProperty(Gt,"AsyncLocalStorageContextManager",{enumerable:!0,get:function(){return FT.AsyncLocalStorageContextManager}})});var Rc,hc=_(()=>{Rc="exception"});var Lr,Nc=_(()=>{p();O();st();hc();Lr=class{_spanContext;kind;parentSpanContext;attributes={};links=[];events=[];startTime;resource;instrumentationScope;_droppedAttributesCount=0;_droppedEventsCount=0;_droppedLinksCount=0;name;status={code:Et.UNSET};endTime=[0,0];_ended=!1;_duration=[-1,-1];_spanProcessor;_spanLimits;_attributeValueLengthLimit;_performanceStartTime;_performanceOffset;_startTimeProvided;constructor(e){let r=Date.now();this._spanContext=e.spanContext,this._performanceStartTime=v.now(),this._performanceOffset=r-(this._performanceStartTime+bt()),this._startTimeProvided=e.startTime!=null,this._spanLimits=e.spanLimits,this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,this._spanProcessor=e.spanProcessor,this.name=e.name,this.parentSpanContext=e.parentSpanContext,this.kind=e.kind,this.links=e.links||[],this.startTime=this._getTime(e.startTime??r),this.resource=e.resource,this.instrumentationScope=e.scope,e.attributes!=null&&this.setAttributes(e.attributes),this._spanProcessor.onStart(this,e.context)}spanContext(){return this._spanContext}setAttribute(e,r){if(r==null||this._isSpanEnded())return this;if(e.length===0)return T.warn(`Invalid attribute key: ${e}`),this;if(!ne(r))return T.warn(`Invalid attribute value set for key: ${e}`),this;let{attributeCountLimit:n}=this._spanLimits;return n!==void 0&&Object.keys(this.attributes).length>=n&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(r),this)}setAttributes(e){for(let[r,n]of Object.entries(e))this.setAttribute(r,n);return this}addEvent(e,r,n){if(this._isSpanEnded())return this;let{eventCountLimit:o}=this._spanLimits;if(o===0)return T.warn("No events allowed."),this._droppedEventsCount++,this;o!==void 0&&this.events.length>=o&&(this._droppedEventsCount===0&&T.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),ie(r)&&(ie(n)||(n=r),r=void 0);let s=Tt(r);return this.events.push({name:e,attributes:s,time:this._getTime(n),droppedAttributesCount:0}),this}addLink(e){return this.links.push(e),this}addLinks(e){return this.links.push(...e),this}setStatus(e){return this._isSpanEnded()?this:(this.status={...e},this.status.message!=null&&typeof e.message!="string"&&(T.warn(`Dropping invalid status.message of type '${typeof e.message}', expected 'string'`),delete this.status.message),this)}updateName(e){return this._isSpanEnded()?this:(this.name=e,this)}end(e){if(this._isSpanEnded()){T.error(`${this.name} ${this._spanContext.traceId}-${this._spanContext.spanId} - You can only call end() on a span once.`);return}this._ended=!0,this.endTime=this._getTime(e),this._duration=Er(this.startTime,this.endTime),this._duration[0]<0&&(T.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&T.warn(`Dropped ${this._droppedEventsCount} events because eventCountLimit reached`),this._spanProcessor.onEnd(this)}_getTime(e){if(typeof e=="number"&&e<=v.now())return oe(e+this._performanceOffset);if(typeof e=="number")return K(e);if(e instanceof Date)return K(e.getTime());if(Vt(e))return e;if(this._startTimeProvided)return K(Date.now());let r=v.now()-this._performanceStartTime;return ae(this.startTime,K(r))}isRecording(){return this._ended===!1}recordException(e,r){let n={};typeof e=="string"?n[ar]=e:e&&(e.code?n[ir]=e.code.toString():e.name&&(n[ir]=e.name),e.message&&(n[ar]=e.message),e.stack&&(n[pi]=e.stack)),n[ir]||n[ar]?this.addEvent(Rc,n,r):T.warn(`Failed to record an exception ${e}`)}get duration(){return this._duration}get ended(){return this._ended}get droppedAttributesCount(){return this._droppedAttributesCount}get droppedEventsCount(){return this._droppedEventsCount}get droppedLinksCount(){return this._droppedLinksCount}_isSpanEnded(){if(this._ended){let e=new Error(`Operation attempted on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`);T.warn(`Cannot execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`,e)}return this._ended}_truncateToLimitUtil(e,r){return e.length<=r?e:e.substring(0,r)}_truncateToSize(e){let r=this._attributeValueLengthLimit;return r<=0?(T.warn(`Attribute value limit must be positive, got ${r}`),e):typeof e=="string"?this._truncateToLimitUtil(e,r):Array.isArray(e)?e.map(n=>typeof n=="string"?this._truncateToLimitUtil(n,r):n):e}}});var j,me=_(()=>{(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(j||(j={}))});var et,Ir=_(()=>{me();et=class{shouldSample(){return{decision:j.NOT_RECORD}}toString(){return"AlwaysOffSampler"}}});var w,Dr=_(()=>{me();w=class{shouldSample(){return{decision:j.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}}});var it,_o=_(()=>{p();O();Ir();Dr();it=class{_root;_remoteParentSampled;_remoteParentNotSampled;_localParentSampled;_localParentNotSampled;constructor(e){this._root=e.root,this._root||(F(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new w),this._remoteParentSampled=e.remoteParentSampled??new w,this._remoteParentNotSampled=e.remoteParentNotSampled??new et,this._localParentSampled=e.localParentSampled??new w,this._localParentNotSampled=e.localParentNotSampled??new et}shouldSample(e,r,n,o,s,a){let i=D.getSpanContext(e);return!i||!J(i)?this._root.shouldSample(e,r,n,o,s,a):i.isRemote?i.traceFlags&h.SAMPLED?this._remoteParentSampled.shouldSample(e,r,n,o,s,a):this._remoteParentNotSampled.shouldSample(e,r,n,o,s,a):i.traceFlags&h.SAMPLED?this._localParentSampled.shouldSample(e,r,n,o,s,a):this._localParentNotSampled.shouldSample(e,r,n,o,s,a)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}}});var Ct,Eo=_(()=>{p();me();Ct=class{_ratio;_upperBound;constructor(e=0){this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(this._ratio*4294967295)}shouldSample(e,r){return{decision:te(r)&&this._accumulate(r)<this._upperBound?j.RECORD_AND_SAMPLED:j.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(e){return typeof e!="number"||isNaN(e)?0:e>=1?1:e<=0?0:e}_accumulate(e){let r=0;for(let n=0;n<e.length/8;n++){let o=n*8,s=parseInt(e.slice(o,o+8),16);r=(r^s)>>>0}return r}}});function yr(){return{sampler:So(),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:m("OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT")??1/0,attributeCountLimit:m("OTEL_ATTRIBUTE_COUNT_LIMIT")??128},spanLimits:{attributeValueLengthLimit:m("OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT")??1/0,attributeCountLimit:m("OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT")??128,linkCountLimit:m("OTEL_SPAN_LINK_COUNT_LIMIT")??128,eventCountLimit:m("OTEL_SPAN_EVENT_COUNT_LIMIT")??128,attributePerEventCountLimit:m("OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT")??128,attributePerLinkCountLimit:m("OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT")??128}}}function So(){let t=Z("OTEL_TRACES_SAMPLER")??"parentbased_always_on";switch(t){case"always_on":return new w;case"always_off":return new et;case"parentbased_always_on":return new it({root:new w});case"parentbased_always_off":return new it({root:new et});case"traceidratio":return new Ct(Oc());case"parentbased_traceidratio":return new it({root:new Ct(Oc())});default:return T.error(`OTEL_TRACES_SAMPLER value "${t}" invalid, defaulting to "parentbased_always_on".`),new it({root:new w})}}function Oc(){let t=m("OTEL_TRACES_SAMPLER_ARG");return t==null?(T.error(`OTEL_TRACES_SAMPLER_ARG is blank, defaulting to ${Ur}.`),Ur):t<0||t>1?(T.error(`OTEL_TRACES_SAMPLER_ARG=${t} was given, but it is out of range ([0..1]), defaulting to ${Ur}.`),Ur):t}var Ur,To=_(()=>{p();O();Ir();Dr();_o();Eo();Ur=1});function Mc(t){let e={sampler:So()},r=yr(),n=Object.assign({},r,e,t);return n.generalLimits=Object.assign({},r.generalLimits,t.generalLimits||{}),n.spanLimits=Object.assign({},r.spanLimits,t.spanLimits||{}),n}function Cc(t){var r,n,o,s;let e=Object.assign({},t.spanLimits);return e.attributeCountLimit=((r=t.spanLimits)==null?void 0:r.attributeCountLimit)??((n=t.generalLimits)==null?void 0:n.attributeCountLimit)??m("OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT")??m("OTEL_ATTRIBUTE_COUNT_LIMIT")??KT,e.attributeValueLengthLimit=((o=t.spanLimits)==null?void 0:o.attributeValueLengthLimit)??((s=t.generalLimits)==null?void 0:s.attributeValueLengthLimit)??m("OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT")??m("OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT")??jT,Object.assign({},t,{spanLimits:e})}var KT,jT,po=_(()=>{To();O();KT=128,jT=1/0});var br,Pc=_(()=>{p();O();br=class{_exporter;_maxExportBatchSize;_maxQueueSize;_scheduledDelayMillis;_exportTimeoutMillis;_isExporting=!1;_finishedSpans=[];_timer;_shutdownOnce;_droppedSpansCount=0;constructor(e,r){this._exporter=e,this._maxExportBatchSize=typeof(r==null?void 0:r.maxExportBatchSize)=="number"?r.maxExportBatchSize:m("OTEL_BSP_MAX_EXPORT_BATCH_SIZE")??512,this._maxQueueSize=typeof(r==null?void 0:r.maxQueueSize)=="number"?r.maxQueueSize:m("OTEL_BSP_MAX_QUEUE_SIZE")??2048,this._scheduledDelayMillis=typeof(r==null?void 0:r.scheduledDelayMillis)=="number"?r.scheduledDelayMillis:m("OTEL_BSP_SCHEDULE_DELAY")??5e3,this._exportTimeoutMillis=typeof(r==null?void 0:r.exportTimeoutMillis)=="number"?r.exportTimeoutMillis:m("OTEL_BSP_EXPORT_TIMEOUT")??3e4,this._shutdownOnce=new tt(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(T.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}forceFlush(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()}onStart(e,r){}onEnd(e){this._shutdownOnce.isCalled||(e.spanContext().traceFlags&h.SAMPLED)!==0&&this._addToBuffer(e)}shutdown(){return this._shutdownOnce.call()}_shutdown(){return Promise.resolve().then(()=>this.onShutdown()).then(()=>this._flushAll()).then(()=>this._exporter.shutdown())}_addToBuffer(e){if(this._finishedSpans.length>=this._maxQueueSize){this._droppedSpansCount===0&&T.debug("maxQueueSize reached, dropping spans"),this._droppedSpansCount++;return}this._droppedSpansCount>0&&(T.warn(`Dropped ${this._droppedSpansCount} spans because maxQueueSize reached`),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()}_flushAll(){return new Promise((e,r)=>{let n=[],o=Math.ceil(this._finishedSpans.length/this._maxExportBatchSize);for(let s=0,a=o;s<a;s++)n.push(this._flushOneBatch());Promise.all(n).then(()=>{e()}).catch(r)})}_flushOneBatch(){return this._clearTimer(),this._finishedSpans.length===0?Promise.resolve():new Promise((e,r)=>{let n=setTimeout(()=>{r(new Error("Timeout"))},this._exportTimeoutMillis);I.with(Dt(I.active()),()=>{let o;this._finishedSpans.length<=this._maxExportBatchSize?(o=this._finishedSpans,this._finishedSpans=[]):o=this._finishedSpans.splice(0,this._maxExportBatchSize);let s=()=>this._exporter.export(o,i=>{clearTimeout(n),i.code===g.SUCCESS?e():r(i.error??new Error("BatchSpanProcessor: span export failed"))}),a=null;for(let i=0,c=o.length;i<c;i++){let E=o[i];E.resource.asyncAttributesPending&&E.resource.waitForAsyncAttributes&&(a??(a=[]),a.push(E.resource.waitForAsyncAttributes()))}a===null?s():Promise.all(a).then(s,i=>{F(i),r(i)})})})}_maybeStartTimer(){if(this._isExporting)return;let e=()=>{this._isExporting=!0,this._flushOneBatch().finally(()=>{this._isExporting=!1,this._finishedSpans.length>0&&(this._clearTimer(),this._maybeStartTimer())}).catch(r=>{this._isExporting=!1,F(r)})};if(this._finishedSpans.length>=this._maxExportBatchSize)return e();this._timer===void 0&&(this._timer=setTimeout(()=>e(),this._scheduledDelayMillis),yt(this._timer))}_clearTimer(){this._timer!==void 0&&(clearTimeout(this._timer),this._timer=void 0)}}});var Ht,gc=_(()=>{Pc();Ht=class extends br{onShutdown(){}}});function xc(t){return function(){for(let r=0;r<t/4;r++)Vr.writeUInt32BE(Math.random()*2**32>>>0,r*4);for(let r=0;r<t&&!(Vr[r]>0);r++)r===t-1&&(Vr[t-1]=1);return Vr.toString("hex",0,t)}}var ut,Vr,Lc=_(()=>{ut=class{generateTraceId=xc(16);generateSpanId=xc(8)},Vr=Buffer.allocUnsafe(16)});var Ic=_(()=>{gc();Lc()});var uo=_(()=>{Ic()});var vr,Dc=_(()=>{p();O();Nc();po();uo();vr=class{_sampler;_generalLimits;_spanLimits;_idGenerator;instrumentationScope;_resource;_spanProcessor;constructor(e,r,n,o){let s=Mc(r);this._sampler=s.sampler,this._generalLimits=s.generalLimits,this._spanLimits=s.spanLimits,this._idGenerator=r.idGenerator||new ut,this._resource=n,this._spanProcessor=o,this.instrumentationScope=e}startSpan(e,r={},n=I.active()){r.root&&(n=D.deleteSpan(n));let o=D.getSpan(n);if(St(n))return T.debug("Instrumentation suppressed, returning Noop Span"),D.wrapSpanContext(Lt);let s=o==null?void 0:o.spanContext(),a=this._idGenerator.generateSpanId(),i,c,E;!s||!D.isSpanContextValid(s)?c=this._idGenerator.generateTraceId():(c=s.traceId,E=s.traceState,i=s);let S=r.kind??It.INTERNAL,u=(r.links??[]).map(nt=>({context:nt.context,attributes:Tt(nt.attributes)})),A=Tt(r.attributes),R=this._sampler.shouldSample(n,c,e,S,A,u);E=R.traceState??E;let U=R.decision===Rt.RECORD_AND_SAMPLED?h.SAMPLED:h.NONE,y={traceId:c,spanId:a,traceFlags:U,traceState:E};if(R.decision===Rt.NOT_RECORD)return T.debug("Recording is off, propagating context in a non-recording span"),D.wrapSpanContext(y);let Y=Tt(Object.assign(A,R.attributes));return new Lr({resource:this._resource,scope:this.instrumentationScope,context:n,spanContext:y,name:e,kind:S,links:u,parentSpanContext:i,attributes:Y,startTime:r.startTime,spanProcessor:this._spanProcessor,spanLimits:this._spanLimits})}startActiveSpan(e,r,n,o){let s,a,i;if(arguments.length<2)return;arguments.length===2?i=r:arguments.length===3?(s=r,i=n):(s=r,a=n,i=o);let c=a??I.active(),E=this.startSpan(e,s,c),S=D.setSpan(c,E);return I.with(S,i,void 0,E)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}}});var wr,Uc=_(()=>{O();wr=class{_spanProcessors;constructor(e){this._spanProcessors=e}forceFlush(){let e=[];for(let r of this._spanProcessors)e.push(r.forceFlush());return new Promise(r=>{Promise.all(e).then(()=>{r()}).catch(n=>{F(n||new Error("MultiSpanProcessor: forceFlush failed")),r()})})}onStart(e,r){for(let n of this._spanProcessors)n.onStart(e,r)}onEnd(e){for(let r of this._spanProcessors)r.onEnd(e)}shutdown(){let e=[];for(let r of this._spanProcessors)e.push(r.shutdown());return new Promise((r,n)=>{Promise.all(e).then(()=>{r()},n)})}}});var Pt,Br,yc=_(()=>{O();oo();Dc();To();Uc();po();(function(t){t[t.resolved=0]="resolved",t[t.timeout=1]="timeout",t[t.error=2]="error",t[t.unresolved=3]="unresolved"})(Pt||(Pt={}));Br=class{_config;_tracers=new Map;_resource;_activeSpanProcessor;constructor(e={}){var o;let r=fr({},yr(),Cc(e));this._resource=r.resource??Nr(),this._config=Object.assign({},r,{resource:this._resource});let n=[];(o=e.spanProcessors)!=null&&o.length&&n.push(...e.spanProcessors),this._activeSpanProcessor=new wr(n)}getTracer(e,r,n){let o=`${e}@${r||""}:${(n==null?void 0:n.schemaUrl)||""}`;return this._tracers.has(o)||this._tracers.set(o,new vr({name:e,version:r,schemaUrl:n==null?void 0:n.schemaUrl},this._config,this._resource,this._activeSpanProcessor)),this._tracers.get(o)}forceFlush(){let e=this._config.forceFlushTimeoutMillis,r=this._activeSpanProcessor._spanProcessors.map(n=>new Promise(o=>{let s,a=setTimeout(()=>{o(new Error(`Span processor did not completed within timeout period of ${e} ms`)),s=Pt.timeout},e);n.forceFlush().then(()=>{clearTimeout(a),s!==Pt.timeout&&(s=Pt.resolved,o(s))}).catch(i=>{clearTimeout(a),s=Pt.error,o(i)})}));return new Promise((n,o)=>{Promise.all(r).then(s=>{let a=s.filter(i=>i!==Pt.resolved);a.length>0?o(a):n()}).catch(s=>o([s]))})}shutdown(){return this._activeSpanProcessor.shutdown()}}});var Gr,bc=_(()=>{O();Gr=class{export(e,r){return this._sendSpans(e,r)}shutdown(){return this._sendSpans([]),this.forceFlush()}forceFlush(){return Promise.resolve()}_exportInfo(e){var r;return{resource:{attributes:e.resource.attributes},instrumentationScope:e.instrumentationScope,traceId:e.spanContext().traceId,parentSpanContext:e.parentSpanContext,traceState:(r=e.spanContext().traceState)==null?void 0:r.serialize(),name:e.name,id:e.spanContext().spanId,kind:e.kind,timestamp:se(e.startTime),duration:se(e.duration),attributes:e.attributes,status:e.status,events:e.events,links:e.links}}_sendSpans(e,r){for(let n of e)console.dir(this._exportInfo(n),{depth:3});if(r)return r({code:g.SUCCESS})}}});var Hr,Vc=_(()=>{O();Hr=class{_finishedSpans=[];_stopped=!1;export(e,r){if(this._stopped)return r({code:g.FAILED,error:new Error("Exporter has been stopped")});this._finishedSpans.push(...e),setTimeout(()=>r({code:g.SUCCESS}),0)}shutdown(){return this._stopped=!0,this._finishedSpans=[],this.forceFlush()}forceFlush(){return Promise.resolve()}reset(){this._finishedSpans=[]}getFinishedSpans(){return this._finishedSpans}}});var Yr,vc=_(()=>{p();O();Yr=class{_exporter;_shutdownOnce;_pendingExports;constructor(e){this._exporter=e,this._shutdownOnce=new tt(this._shutdown,this),this._pendingExports=new Set}async forceFlush(){await Promise.all(Array.from(this._pendingExports)),this._exporter.forceFlush&&await this._exporter.forceFlush()}onStart(e,r){}onEnd(e){if(this._shutdownOnce.isCalled||(e.spanContext().traceFlags&h.SAMPLED)===0)return;let r=this._doExport(e).catch(n=>F(n));this._pendingExports.add(r),r.finally(()=>this._pendingExports.delete(r))}async _doExport(e){var n,o;e.resource.asyncAttributesPending&&await((o=(n=e.resource).waitForAsyncAttributes)==null?void 0:o.call(n));let r=await qn._export(this._exporter,[e]);if(r.code!==g.SUCCESS)throw r.error??new Error(`SimpleSpanProcessor: span export failed (status ${r})`)}shutdown(){return this._shutdownOnce.call()}_shutdown(){return this._exporter.shutdown()}}});var kr,wc=_(()=>{kr=class{onStart(e,r){}onEnd(e){}shutdown(){return Promise.resolve()}forceFlush(){return Promise.resolve()}}});var Ao={};q(Ao,{AlwaysOffSampler:()=>et,AlwaysOnSampler:()=>w,BasicTracerProvider:()=>Br,BatchSpanProcessor:()=>Ht,ConsoleSpanExporter:()=>Gr,InMemorySpanExporter:()=>Hr,NoopSpanProcessor:()=>kr,ParentBasedSampler:()=>it,RandomIdGenerator:()=>ut,SamplingDecision:()=>j,SimpleSpanProcessor:()=>Yr,TraceIdRatioBasedSampler:()=>Ct});var lo=_(()=>{yc();uo();bc();Vc();vc();wc();Ir();Dr();_o();Eo();me()});var Bc=xt(Fr=>{"use strict";Object.defineProperty(Fr,"__esModule",{value:!0});Fr.NodeTracerProvider=void 0;var WT=mc(),$T=(lo(),k(Ao)),Re=(p(),k(Nt)),fo=(O(),k(ga));function qT(t){if(t!==null){if(t===void 0){let e=new WT.AsyncLocalStorageContextManager;e.enable(),Re.context.setGlobalContextManager(e);return}t.enable(),Re.context.setGlobalContextManager(t)}}function XT(t){if(t!==null){if(t===void 0){Re.propagation.setGlobalPropagator(new fo.CompositePropagator({propagators:[new fo.W3CTraceContextPropagator,new fo.W3CBaggagePropagator]}));return}Re.propagation.setGlobalPropagator(t)}}var mo=class extends $T.BasicTracerProvider{constructor(e={}){super(e)}register(e={}){Re.trace.setGlobalTracerProvider(this),qT(e.contextManager),XT(e.propagator)}};Fr.NodeTracerProvider=mo});var Gc=xt(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});l.TraceIdRatioBasedSampler=l.SimpleSpanProcessor=l.SamplingDecision=l.RandomIdGenerator=l.ParentBasedSampler=l.NoopSpanProcessor=l.InMemorySpanExporter=l.ConsoleSpanExporter=l.BatchSpanProcessor=l.BasicTracerProvider=l.AlwaysOnSampler=l.AlwaysOffSampler=l.NodeTracerProvider=void 0;var zT=Bc();Object.defineProperty(l,"NodeTracerProvider",{enumerable:!0,get:function(){return zT.NodeTracerProvider}});var B=(lo(),k(Ao));Object.defineProperty(l,"AlwaysOffSampler",{enumerable:!0,get:function(){return B.AlwaysOffSampler}});Object.defineProperty(l,"AlwaysOnSampler",{enumerable:!0,get:function(){return B.AlwaysOnSampler}});Object.defineProperty(l,"BasicTracerProvider",{enumerable:!0,get:function(){return B.BasicTracerProvider}});Object.defineProperty(l,"BatchSpanProcessor",{enumerable:!0,get:function(){return B.BatchSpanProcessor}});Object.defineProperty(l,"ConsoleSpanExporter",{enumerable:!0,get:function(){return B.ConsoleSpanExporter}});Object.defineProperty(l,"InMemorySpanExporter",{enumerable:!0,get:function(){return B.InMemorySpanExporter}});Object.defineProperty(l,"NoopSpanProcessor",{enumerable:!0,get:function(){return B.NoopSpanProcessor}});Object.defineProperty(l,"ParentBasedSampler",{enumerable:!0,get:function(){return B.ParentBasedSampler}});Object.defineProperty(l,"RandomIdGenerator",{enumerable:!0,get:function(){return B.RandomIdGenerator}});Object.defineProperty(l,"SamplingDecision",{enumerable:!0,get:function(){return B.SamplingDecision}});Object.defineProperty(l,"SimpleSpanProcessor",{enumerable:!0,get:function(){return B.SimpleSpanProcessor}});Object.defineProperty(l,"TraceIdRatioBasedSampler",{enumerable:!0,get:function(){return B.TraceIdRatioBasedSampler}})});function kc(t){return new Ro(t)}function Hc(t,e,r){var n,o,s;return!e&&!r?s=t:r?(n=t,o=e,s=r):(n=t,s=e),n=n??{},o=o??I.active(),{opts:n,ctx:o,fn:s}}function Yc(t,e,r){var n,o=(n=e.onException)!==null&&n!==void 0?n:QT,s=function(i){throw o(i,t),t.end(),i};try{var a=r(t);return typeof(a==null?void 0:a.then)=="function"?a.then(function(i){return t.end(),i},s):(t.end(),a)}catch(i){throw s(i)}}var QT,Ro,Fc=_(()=>{p();QT=function(t,e){e.recordException(t),e.setStatus({code:Et.ERROR})};Ro=function(){function t(e){this._tracer=e,this.startSpan=e.startSpan.bind(this._tracer),this.startActiveSpan=e.startActiveSpan.bind(this._tracer)}return t.prototype.withActiveSpan=function(e,r,n,o){var s=Hc(r,n,o),a=s.opts,i=s.ctx,c=s.fn;return this._tracer.startActiveSpan(e,a,i,function(E){return Yc(E,a,c)})},t.prototype.withSpan=function(e,r,n,o){var s=Hc(r,n,o),a=s.opts,i=s.ctx,c=s.fn,E=this._tracer.startSpan(e,a,i);return Yc(E,a,c)},t}()});var Kc={};q(Kc,{SugaredTracer:()=>Ro,wrapTracer:()=>kc});var jc=_(()=>{Fc()});import{fileURLToPath as Ru}from"url";import{Buffer as cu}from"buffer";import _u from"process";import{pipeline as Eu,Readable as Su}from"stream";import{promisify as Tu}from"util";var lE="__netlify__getTracer",fE="__netlify__shutdownTracers",Yo=async(t,e)=>{var r;return(r=globalThis[lE])==null?void 0:r.call(globalThis,t,e)},ko=async()=>{var t;return(t=globalThis[fE])==null?void 0:t.call(globalThis)};p();O();O();function xa(t){return t>=48&&t<=57?t-48:t>=97&&t<=102?t-87:t-55}function mr(t){let e=new Uint8Array(t.length/2),r=0;for(let n=0;n<t.length;n+=2){let o=xa(t.charCodeAt(n)),s=xa(t.charCodeAt(n+1));e[r++]=o<<4|s}return e}function Ia(t){let e=BigInt(1e9);return BigInt(t[0])*e+BigInt(t[1])}function TT(t){let e=Number(BigInt.asUintN(32,t)),r=Number(BigInt.asUintN(32,t>>BigInt(32)));return{low:e,high:r}}function Da(t){let e=Ia(t);return TT(e)}function pT(t){return Ia(t).toString()}var uT=typeof BigInt<"u"?pT:Sr;function La(t){return t}function Ua(t){if(t!==void 0)return mr(t)}var AT={encodeHrTime:Da,encodeSpanContext:mr,encodeOptionalSpanContext:Ua};function ya(t){if(t===void 0)return AT;let e=t.useLongBits??!0,r=t.useHex??!1;return{encodeHrTime:e?Da:uT,encodeSpanContext:r?La:mr,encodeOptionalSpanContext:r?La:Ua}}function ba(t){return{attributes:Te(t.attributes),droppedAttributesCount:0}}function Va(t){return{name:t.name,version:t.version}}function Te(t){return Object.keys(t).map(e=>va(e,t[e]))}function va(t,e){return{key:t,value:wa(e)}}function wa(t){let e=typeof t;return e==="string"?{stringValue:t}:e==="number"?Number.isInteger(t)?{intValue:t}:{doubleValue:t}:e==="boolean"?{boolValue:t}:t instanceof Uint8Array?{bytesValue:t}:Array.isArray(t)?{arrayValue:{values:t.map(wa)}}:e==="object"&&t!=null?{kvlistValue:{values:Object.entries(t).map(([r,n])=>va(r,n))}}:{}}function LT(t,e){var s,a,i;let r=t.spanContext(),n=t.status,o=(s=t.parentSpanContext)!=null&&s.spanId?e.encodeSpanContext((a=t.parentSpanContext)==null?void 0:a.spanId):void 0;return{traceId:e.encodeSpanContext(r.traceId),spanId:e.encodeSpanContext(r.spanId),parentSpanId:o,traceState:(i=r.traceState)==null?void 0:i.serialize(),name:t.name,kind:t.kind==null?0:t.kind+1,startTimeUnixNano:e.encodeHrTime(t.startTime),endTimeUnixNano:e.encodeHrTime(t.endTime),attributes:Te(t.attributes),droppedAttributesCount:t.droppedAttributesCount,events:t.events.map(c=>DT(c,e)),droppedEventsCount:t.droppedEventsCount,status:{code:n.code,message:n.message},links:t.links.map(c=>IT(c,e)),droppedLinksCount:t.droppedLinksCount}}function IT(t,e){var r;return{attributes:t.attributes?Te(t.attributes):[],spanId:e.encodeSpanContext(t.context.spanId),traceId:e.encodeSpanContext(t.context.traceId),traceState:(r=t.context.traceState)==null?void 0:r.serialize(),droppedAttributesCount:t.droppedAttributesCount||0}}function DT(t,e){return{attributes:t.attributes?Te(t.attributes):[],name:t.name,timeUnixNano:e.encodeHrTime(t.time),droppedAttributesCount:t.droppedAttributesCount||0}}function lc(t,e){let r=ya(e);return{resourceSpans:yT(t,r)}}function UT(t){let e=new Map;for(let r of t){let n=e.get(r.resource);n||(n=new Map,e.set(r.resource,n));let o=`${r.instrumentationScope.name}@${r.instrumentationScope.version||""}:${r.instrumentationScope.schemaUrl||""}`,s=n.get(o);s||(s=[],n.set(o,s)),s.push(r)}return e}function yT(t,e){let r=UT(t),n=[],o=r.entries(),s=o.next();for(;!s.done;){let[a,i]=s.value,c=[],E=i.values(),S=E.next();for(;!S.done;){let A=S.value;if(A.length>0){let R=A.map(U=>LT(U,e));c.push({scope:Va(A[0].instrumentationScope),spans:R,schemaUrl:A[0].instrumentationScope.schemaUrl})}S=E.next()}let u={resource:ba(a),scopeSpans:c,schemaUrl:void 0};n.push(u),s=o.next()}return n}var Cr={serializeRequest:t=>{let e=lc(t,{useHex:!0,useLongBits:!1});return new TextEncoder().encode(JSON.stringify(e))},deserializeResponse:t=>{let e=new TextDecoder;return JSON.parse(e.decode(t))}};var JT=Object.defineProperty,ZT=Object.getOwnPropertyNames,qc=t=>{throw TypeError(t)},Mo=(t,e)=>function(){return t&&(e=(0,t[ZT(t)[0]])(t=0)),e},Xc=(t,e)=>{for(var r in e)JT(t,r,{get:e[r],enumerable:!0})},Co=(t,e,r)=>e.has(t)||qc("Cannot "+r),he=(t,e,r)=>(Co(t,e,"read from private field"),r?r.call(t):e.get(t)),Kr=(t,e,r)=>e.has(t)?qc("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),Wc=(t,e,r,n)=>(Co(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r),tp=(t,e,r)=>(Co(t,e,"access private method"),r),zc,Qc,Jc,Zc=Mo({"src/constants.ts"(){"use strict";zc="__netlify__getTracer",Qc="__netlify__shutdownTracers",Jc="__nfOTLPTrace"}}),t_={};Xc(t_,{NetlifySpanExporter:()=>e_});var Ne,Oe,ho,No,$c,Oo,e_,ep=Mo({"src/bootstrap/netlify_span_exporter.ts"(){"use strict";Zc(),Oo=class r_{constructor(){Kr(this,No),Kr(this,Ne),Kr(this,Oe),Wc(this,Ne,new tt(tp(this,No,$c),this)),Wc(this,Oe,T.createComponentLogger({namespace:"netlify-span-exporter"}))}export(e,r){if(he(this,Oe).debug(`export ${e.length} spans`),he(this,Ne).isCalled){r({code:g.FAILED,error:new Error("Exporter has been shutdown")});return}return console.log(Jc,he(r_,ho).decode(Cr.serializeRequest(e))),r({code:g.SUCCESS})}shutdown(){return he(this,Ne).call()}},Ne=new WeakMap,Oe=new WeakMap,ho=new WeakMap,No=new WeakSet,$c=function(){return he(this,Oe).debug("Shutting down"),Promise.resolve()},Kr(Oo,ho,new TextDecoder),e_=Oo}}),n_={};Xc(n_,{default:()=>o_});var o_,rp=Mo({"package.json"(){o_={name:"@netlify/otel",version:"1.1.0",type:"module",engines:{node:"^14.16.0 || >=16.0.0"},main:"./dist/main.cjs",module:"./dist/main.js",types:"./dist/main.d.ts",exports:{".":{require:{types:"./dist/main.d.cts",default:"./dist/main.cjs"},import:{types:"./dist/main.d.ts",default:"./dist/main.js"},default:{types:"./dist/main.d.ts",default:"./dist/main.js"}},"./package.json":"./package.json","./bootstrap":{require:{types:"./dist/bootstrap/main.d.cts",default:"./dist/bootstrap/main.cjs"},import:{types:"./dist/bootstrap/main.d.ts",default:"./dist/bootstrap/main.js"},default:{types:"./dist/bootstrap/main.d.ts",default:"./dist/bootstrap/main.js"}}},files:["dist/**/*"],scripts:{build:"tsup-node",dev:"tsup-node --watch",prepack:"npm run build",test:"run-s build test:dev","test:dev":"run-s build test:dev:*","test:ci":"run-s build test:ci:*","test:dev:vitest":"vitest run","test:dev:vitest:watch":"vitest watch","test:ci:vitest":"vitest run",publint:"npx -y publint --strict"},keywords:["netlify","cdn"],license:"MIT",repository:"netlify/primitives",bugs:{url:"https://github.com/netlify/primitives/issues"},author:"Netlify Inc.",devDependencies:{"npm-run-all2":"^7.0.2",tsup:"^8.0.0",vitest:"^3.0.0"},dependencies:{"@opentelemetry/api":"^1.9.0","@opentelemetry/core":"^2.0.0","@opentelemetry/otlp-transformer":"^0.200.0","@opentelemetry/resources":"^2.0.0","@opentelemetry/sdk-trace-node":"^2.0.0"}}}});Zc();var s_=async t=>{if(!t.headers.has("x-nf-enable-tracing"))return;let{version:e}=await import("process"),r=e.slice(1),{resourceFromAttributes:n}=await Promise.resolve().then(()=>(oo(),Ac)),{NodeTracerProvider:o,BatchSpanProcessor:s}=await Promise.resolve().then(()=>AE(Gc(),1)),{NetlifySpanExporter:a}=await Promise.resolve().then(()=>(ep(),t_)),i=n({"service.name":t.serviceName,"service.version":t.serviceVersion,"process.runtime.name":"nodejs","process.runtime.version":r,"deployment.environment":t.deploymentEnvironment,"http.url":t.siteUrl,"netlify.site.id":t.siteId,"netlify.site.name":t.siteName}),c=new o({resource:i,spanProcessors:[new s(new a)]});c.register(),Object.defineProperty(globalThis,zc,{enumerable:!1,configurable:!0,writable:!1,value:async function(S,u){let{trace:A}=await Promise.resolve().then(()=>(p(),Nt)),{SugaredTracer:R}=await Promise.resolve().then(()=>(jc(),Kc));if(S)return new R(A.getTracer(S,u));let{default:U}=await Promise.resolve().then(()=>(rp(),n_));return new R(A.getTracer(U.name,U.version))}}),Object.defineProperty(globalThis,Qc,{enumerable:!1,configurable:!0,writable:!1,value:async()=>await c.shutdown()})};var Lh=globalThis.Buffer?t=>Buffer.from(t,"base64").toString():t=>atob(t),i_=globalThis.Buffer?t=>Buffer.from(t).toString("base64"):t=>btoa(t);var __=t=>{throw TypeError(t)},E_=(t,e,r)=>e.has(t)||__("Cannot "+r),b=(t,e,r)=>(E_(t,e,"read from private field"),r?r.call(t):e.get(t)),Ce=(t,e,r)=>e.has(t)?__("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),Pe=(t,e,r,n)=>(E_(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r),qr=(t=>(t.Delete="delete",t.Read="read",t.Write="write",t))(qr||{}),np={invalid_vary:"Responses must not use unsupported directives of the `Netlify-Vary` header (https://ntl.fyi/cache_api_invalid_vary).",no_cache:"Responses must not set cache control headers with the `private`, `no-cache` or `no-store` directives (https://ntl.fyi/cache_api_no_cache).",low_ttl:"Responses must have a cache control header with a `max-age` or `s-maxage` directive (https://ntl.fyi/cache_api_low_ttl).",no_directive:"Responses must have a cache control header with caching directives (https://ntl.fyi/cache_api_no_directive).",no_ttl:"Responses must have a cache control header with a `max-age` or `s-maxage` directive (https://ntl.fyi/cache_api_no_ttl).",no_status:"Responses must specify a status code (https://ntl.fyi/cache_api_no_status).",invalid_directive:"Responses must have a cache control header with caching directives (https://ntl.fyi/cache_api_invalid_directive).",status:"Responses must have a status code between 200 and 299 (https://ntl.fyi/cache_api_status)."},op="The server has returned an unexpected error (https://ntl.fyi/cache_api_error).",sp="netlify-programmable-error",ip="netlify-programmable-headers",ap="netlify-programmable-status",cp="netlify-programmable-store",_p="netlify-forwarded-host",Ep="user-agent",a_=new Set(["http:","https:"]),Sp=new Set(["cookie","content-encoding","content-length"]),jr=Symbol("getInternalHeaders"),c_=Symbol("serializeResourceHeaders"),Yt,Wr,Me,Tp=class{constructor({getContext:t,name:e,userAgent:r}){Ce(this,Yt),Ce(this,Wr),Ce(this,Me),Pe(this,Yt,t),Pe(this,Wr,e),Pe(this,Me,r)}[jr](t){let{host:e,token:r}=t,n={Authorization:`Bearer ${r}`,[cp]:b(this,Wr)};return e&&(n[_p]=e),b(this,Me)&&(n[Ep]=b(this,Me)),n}[c_](t){let e={};return t.forEach((r,n)=>{Sp.has(n)||(n==="set-cookie"?(e[n]=e[n]||[],e[n].push(r)):e[n]=r.split(","))}),i_(JSON.stringify(e))}async add(t){await this.put(new Request(t),await fetch(t))}async addAll(t){await Promise.allSettled(t.map(e=>this.add(e)))}async delete(t){let e=b(this,Yt).call(this,{operation:"delete"});if(e){let r=Po(t);await fetch(`${e.url}/${go(r)}`,{headers:this[jr](e),method:"DELETE"})}return!0}async keys(t){return[]}async match(t){try{let e=b(this,Yt).call(this,{operation:"read"});if(!e)return;let r=Po(t),n=`${e.url}/${go(r)}`,o=await fetch(n,{headers:this[jr](e),method:"GET"});return o.ok?o:void 0}catch{}}async matchAll(t,e){if(!t)return[];let r=await this.match(t);return r?[r]:[]}async put(t,e){var s,a,i;if(!e.ok)throw new TypeError(`Cannot cache response with status ${e.status}.`);if(t instanceof Request&&t.method!=="GET")throw new TypeError(`Cannot cache response to ${t.method} request.`);if(e.status===206)throw new TypeError("Cannot cache response to a range request (206 Partial Content).");if((s=e.headers.get("vary"))!=null&&s.includes("*"))throw new TypeError("Cannot cache response with 'Vary: *' header.");let r=b(this,Yt).call(this,{operation:"write"});if(!r)return;let n=Po(t),o=await fetch(`${r.url}/${go(n)}`,{body:e.body,headers:{...this[jr](r),[ip]:this[c_](e.headers),[ap]:e.status.toString()},duplex:"half",method:"POST"});if(!o.ok){let c=((a=o.headers)==null?void 0:a.get(sp))??"",E=np[c]||op;(i=r.logger)==null||i.call(r,`Failed to write to the cache: ${E}`)}}};Yt=new WeakMap;Wr=new WeakMap;Me=new WeakMap;var Po=t=>{let e;if(t instanceof Request)e=new URL(t.url);else try{e=new URL(String(t))}catch{throw new TypeError(`${t} is not a valid URL.`)}if(!a_.has(e.protocol))throw new TypeError(`Cannot cache response for URL with unsupported protocol (${e.protocol}). Supported protocols are ${[...a_].join(", ")}.`);return e},go=t=>encodeURIComponent(t.toString()),$r,rt,S_=class{constructor(t){Ce(this,$r),Ce(this,rt),Pe(this,$r,t),Pe(this,rt,new Map)}open(t){let e=b(this,rt).get(t);return e||(e=new Tp({...b(this,$r),name:t}),b(this,rt).set(t,e)),Promise.resolve(e)}has(t){return Promise.resolve(b(this,rt).has(t))}delete(t){return Promise.resolve(b(this,rt).delete(t))}keys(){return Promise.resolve([...b(this,rt).keys()])}async match(t,e){var r;if(e!=null&&e.cacheName)return(r=b(this,rt).get(e.cacheName))==null?void 0:r.match(t);for(let n of b(this,rt).values())if(await n.match(t)===void 0)return}};$r=new WeakMap;rt=new WeakMap;var kt=class t extends Error{constructor(e){super(e),this.name="NetlifyUserError",Object.setPrototypeOf(this,t.prototype)}};var pp={"cache-api-read":100,"cache-api-write":20},Xr=class{constructor(e=pp){this.counts=new Map,this.limits=e}register(e){let r=this.counts.get(e)||0,n=this.limits[e]||0;return r>=n?!1:(this.counts.set(e,r+1),!0)}};import{AsyncLocalStorage as up}from"async_hooks";var G=new up;import{env as T_}from"process";var zr=()=>!!T_.NETLIFY_DEV||!!T_.NETLIFY_LOCAL;var p_="__nfSystemLog",Ft=(t,e)=>{zr()||console.log(p_,{msg:t,fields:e})},xo=t=>{console.log(p_,JSON.stringify(t))};var u_=t=>{let{pcToken:e,pcURL:r,rawUrl:n}=t;return!e||!r?null:{host:new URL(n).hostname,token:e,url:new URL("/.netlify/cache",r).toString()}},Ap=()=>{globalThis.caches=new S_({getContext:({operation:t})=>{let e=G.getStore();if(!(e!=null&&e.operationCounter))throw new kt("The Cache API must be used within the scope of the request handler. Refer to https://ntl.fyi/cache-api-scope for more information.");let{cacheAPI:r,operationCounter:n}=e,o=t===qr.Delete||t===qr.Write?"cache-api-write":"cache-api-read";return n.register(o)?r||(Ft("missing Cache API metadata in request"),null):(console.log(`You've exceeded the number of allowed Cache API ${o==="cache-api-write"?"writes":"reads"} for a single invocation. Refer to https://ntl.fyi/cache-api-limits for more information.`),null)},userAgent:"netlify-functions"})};Ap();var A_="x-nf-client-connection-ip",l_="x-nf-geo",f_="x-nf-account-id",Qr="x-nf-deploy-id",d_="x-nf-deploy-context",m_="x-nf-deploy-published",R_="x-nf-site-id",h_="x-nf-request-flags",Lo="x-nf-invocation-metadata",N_="x-nf-request-id",O_="x-nf-start-timestamp",M_="x-nf-trace-span-id",lp=255,C_=t=>{let e=new Headers;return Object.entries(t).forEach(([r,n])=>{if(n!==void 0)try{e.set(r.toLowerCase(),n)}catch(o){if([...n].every(a=>a.codePointAt(0)<=lp))throw o;console.warn(`Discarded request header '${r}' because it contains non-ASCII characters`)}}),e},P_=t=>{let e={};for(let[r,n]of t.entries())r in e?e[r].push(n):e[r]=[n];return e};var Jr=t=>({id:t.headers.get(f_)??""});var Zr=t=>({context:t.get(d_)??"",id:t.get(Qr)??"",published:t.get(m_)==="1"});import{Buffer as fp}from"buffer";var en=Symbol("Request flags"),ge=Symbol("Request route"),dp=typeof Request>"u"?class{}:Request,g_,tn=class extends(g_=dp,en,ge,g_){},x_=(t,e)=>{if(!(t==null||t===""))return e?fp.from(t,"base64"):t};var Kt,Le,xe=class{constructor(e){an(this,Kt);an(this,Le);cn(this,Kt,new Set),cn(this,Le,e)}get(e){let r=we(this,Le)[e];return r!==void 0&&we(this,Kt).add(e),r}get evaluations(){return we(this,Kt)}};Kt=new WeakMap,Le=new WeakMap;var L_=t=>t[en]??new xe({}),I_=(t,e)=>{t[en]=e};import{Buffer as mp}from"buffer";var D_=t=>{if(t===null)return{};try{let{postal_code:e,...r}=JSON.parse(mp.from(t,"base64").toString("utf-8"));return Object.fromEntries(Object.entries({...r,postalCode:e}).filter(([,o])=>o!==void 0))}catch{return{}}};var U_=t=>t??"";var Ue=class{constructor(t,e,r,n,o,s){this.type=3,this.name="",this.prefix="",this.value="",this.suffix="",this.modifier=3,this.type=t,this.name=e,this.prefix=r,this.value=n,this.suffix=o,this.modifier=s}hasCustomName(){return this.name!==""&&typeof this.name!="number"}},Rp=/[$_\p{ID_Start}]/u,hp=/[$_\u200C\u200D\p{ID_Continue}]/u,Do=".*";function Np(t,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(t)}function V_(t,e=!1){let r=[],n=0;for(;n<t.length;){let o=t[n],s=function(a){if(!e)throw new TypeError(a);r.push({type:"INVALID_CHAR",index:n,value:t[n++]})};if(o==="*"){r.push({type:"ASTERISK",index:n,value:t[n++]});continue}if(o==="+"||o==="?"){r.push({type:"OTHER_MODIFIER",index:n,value:t[n++]});continue}if(o==="\\"){r.push({type:"ESCAPED_CHAR",index:n++,value:t[n++]});continue}if(o==="{"){r.push({type:"OPEN",index:n,value:t[n++]});continue}if(o==="}"){r.push({type:"CLOSE",index:n,value:t[n++]});continue}if(o===":"){let a="",i=n+1;for(;i<t.length;){let c=t.substr(i,1);if(i===n+1&&Rp.test(c)||i!==n+1&&hp.test(c)){a+=t[i++];continue}break}if(!a){s(`Missing parameter name at ${n}`);continue}r.push({type:"NAME",index:n,value:a}),n=i;continue}if(o==="("){let a=1,i="",c=n+1,E=!1;if(t[c]==="?"){s(`Pattern cannot start with "?" at ${c}`);continue}for(;c<t.length;){if(!Np(t[c],!1)){s(`Invalid character '${t[c]}' at ${c}.`),E=!0;break}if(t[c]==="\\"){i+=t[c++]+t[c++];continue}if(t[c]===")"){if(a--,a===0){c++;break}}else if(t[c]==="("&&(a++,t[c+1]!=="?")){s(`Capturing groups are not allowed at ${c}`),E=!0;break}i+=t[c++]}if(E)continue;if(a){s(`Unbalanced pattern at ${n}`);continue}if(!i){s(`Missing pattern at ${n}`);continue}r.push({type:"REGEX",index:n,value:i}),n=c;continue}r.push({type:"CHAR",index:n,value:t[n++]})}return r.push({type:"END",index:n,value:""}),r}function v_(t,e={}){let r=V_(t);e.delimiter??(e.delimiter="/#?"),e.prefixes??(e.prefixes="./");let n=`[^${H(e.delimiter)}]+?`,o=[],s=0,a=0,i="",c=new Set,E=f=>{if(a<r.length&&r[a].type===f)return r[a++].value},S=()=>E("OTHER_MODIFIER")??E("ASTERISK"),u=f=>{let N=E(f);if(N!==void 0)return N;let{type:M,index:x}=r[a];throw new TypeError(`Unexpected ${M} at ${x}, expected ${f}`)},A=()=>{let f="",N;for(;N=E("CHAR")??E("ESCAPED_CHAR");)f+=N;return f},R=f=>f,U=e.encodePart||R,y="",Y=f=>{y+=f},gt=()=>{y.length&&(o.push(new Ue(3,"","",U(y),"",3)),y="")},nt=(f,N,M,x,be)=>{let C=3;switch(be){case"?":C=1;break;case"*":C=0;break;case"+":C=2;break}if(!N&&!M&&C===3){Y(f);return}if(gt(),!N&&!M){if(!f)return;o.push(new Ue(3,"","",U(f),"",C));return}let L;M?M==="*"?L=Do:L=M:L=n;let W=2;L===n?(W=1,L=""):L===Do&&(W=0,L="");let $;if(N?$=N:M&&($=s++),c.has($))throw new TypeError(`Duplicate name '${$}'.`);c.add($),o.push(new Ue(W,$,U(f),L,U(x),C))};for(;a<r.length;){let f=E("CHAR"),N=E("NAME"),M=E("REGEX");if(!N&&!M&&(M=E("ASTERISK")),N||M){let C=f??"";e.prefixes.indexOf(C)===-1&&(Y(C),C=""),gt();let L=S();nt(C,N,M,"",L);continue}let x=f??E("ESCAPED_CHAR");if(x){Y(x);continue}if(E("OPEN")){let C=A(),L=E("NAME"),W=E("REGEX");!L&&!W&&(W=E("ASTERISK"));let $=A();u("CLOSE");let Ve=S();nt(C,L,W,$,Ve);continue}gt(),u("END")}return o}function H(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function y_(t){return t&&t.ignoreCase?"ui":"u"}function Op(t,e,r){return w_(v_(t,r),e,r)}function jt(t){switch(t){case 0:return"*";case 1:return"?";case 2:return"+";case 3:return""}}function w_(t,e,r={}){r.delimiter??(r.delimiter="/#?"),r.prefixes??(r.prefixes="./"),r.sensitive??(r.sensitive=!1),r.strict??(r.strict=!1),r.end??(r.end=!0),r.start??(r.start=!0),r.endsWith="";let n=r.start?"^":"";for(let i of t){if(i.type===3){i.modifier===3?n+=H(i.value):n+=`(?:${H(i.value)})${jt(i.modifier)}`;continue}e&&e.push(i.name);let c=`[^${H(r.delimiter)}]+?`,E=i.value;if(i.type===1?E=c:i.type===0&&(E=Do),!i.prefix.length&&!i.suffix.length){i.modifier===3||i.modifier===1?n+=`(${E})${jt(i.modifier)}`:n+=`((?:${E})${jt(i.modifier)})`;continue}if(i.modifier===3||i.modifier===1){n+=`(?:${H(i.prefix)}(${E})${H(i.suffix)})`,n+=jt(i.modifier);continue}n+=`(?:${H(i.prefix)}`,n+=`((?:${E})(?:`,n+=H(i.suffix),n+=H(i.prefix),n+=`(?:${E}))*)${H(i.suffix)})`,i.modifier===0&&(n+="?")}let o=`[${H(r.endsWith)}]|$`,s=`[${H(r.delimiter)}]`;if(r.end)return r.strict||(n+=`${s}?`),r.endsWith.length?n+=`(?=${o})`:n+="$",new RegExp(n,y_(r));r.strict||(n+=`(?:${s}(?=${o}))?`);let a=!1;if(t.length){let i=t[t.length-1];i.type===3&&i.modifier===3&&(a=r.delimiter.indexOf(i)>-1)}return a||(n+=`(?=${s}|${o})`),new RegExp(n,y_(r))}var lt={delimiter:"",prefixes:"",sensitive:!0,strict:!0},Mp={delimiter:".",prefixes:"",sensitive:!0,strict:!0},Cp={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function Pp(t,e){return t.length?t[0]==="/"?!0:!e||t.length<2?!1:(t[0]=="\\"||t[0]=="{")&&t[1]=="/":!1}function B_(t,e){return t.startsWith(e)?t.substring(e.length,t.length):t}function gp(t,e){return t.endsWith(e)?t.substr(0,t.length-e.length):t}function G_(t){return!t||t.length<2?!1:t[0]==="["||(t[0]==="\\"||t[0]==="{")&&t[1]==="["}var H_=["ftp","file","http","https","ws","wss"];function Y_(t){if(!t)return!0;for(let e of H_)if(t.test(e))return!0;return!1}function xp(t,e){if(t=B_(t,"#"),e||t==="")return t;let r=new URL("https://example.com");return r.hash=t,r.hash?r.hash.substring(1,r.hash.length):""}function Lp(t,e){if(t=B_(t,"?"),e||t==="")return t;let r=new URL("https://example.com");return r.search=t,r.search?r.search.substring(1,r.search.length):""}function Ip(t,e){return e||t===""?t:G_(t)?K_(t):F_(t)}function Dp(t,e){if(e||t==="")return t;let r=new URL("https://example.com");return r.password=t,r.password}function Up(t,e){if(e||t==="")return t;let r=new URL("https://example.com");return r.username=t,r.username}function yp(t,e,r){if(r||t==="")return t;if(e&&!H_.includes(e))return new URL(`${e}:${t}`).pathname;let n=t[0]=="/";return t=new URL(n?t:"/-"+t,"https://example.com").pathname,n||(t=t.substring(2,t.length)),t}function bp(t,e,r){return k_(e)===t&&(t=""),r||t===""?t:j_(t)}function Vp(t,e){return t=gp(t,":"),e||t===""?t:Uo(t)}function k_(t){switch(t){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function Uo(t){if(t==="")return t;if(/^[-+.A-Za-z0-9]*$/.test(t))return t.toLowerCase();throw new TypeError(`Invalid protocol '${t}'.`)}function vp(t){if(t==="")return t;let e=new URL("https://example.com");return e.username=t,e.username}function wp(t){if(t==="")return t;let e=new URL("https://example.com");return e.password=t,e.password}function F_(t){if(t==="")return t;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(t))throw new TypeError(`Invalid hostname '${t}'`);let e=new URL("https://example.com");return e.hostname=t,e.hostname}function K_(t){if(t==="")return t;if(/[^0-9a-fA-F[\]:]/g.test(t))throw new TypeError(`Invalid IPv6 hostname '${t}'`);return t.toLowerCase()}function j_(t){if(t===""||/^[0-9]*$/.test(t)&&parseInt(t)<=65535)return t;throw new TypeError(`Invalid port '${t}'.`)}function Bp(t){if(t==="")return t;let e=new URL("https://example.com");return e.pathname=t[0]!=="/"?"/-"+t:t,t[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function Gp(t){return t===""?t:new URL(`data:${t}`).pathname}function Hp(t){if(t==="")return t;let e=new URL("https://example.com");return e.search=t,e.search.substring(1,e.search.length)}function Yp(t){if(t==="")return t;let e=new URL("https://example.com");return e.hash=t,e.hash.substring(1,e.hash.length)}var kp=class{constructor(t){this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=0,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=t}get result(){return this.internalResult}parse(){for(this.tokenList=V_(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===0){this.rewind(),this.isHashPrefix()?this.changeState(9,1):this.isSearchPrefix()?(this.changeState(8,1),this.internalResult.hash=""):(this.changeState(7,0),this.internalResult.search="",this.internalResult.hash="");continue}else if(this.state===2){this.rewindAndSetState(5);continue}this.changeState(10,0);break}if(this.groupDepth>0)if(this.isGroupClose())this.groupDepth-=1;else continue;if(this.isGroupOpen()){this.groupDepth+=1;continue}switch(this.state){case 0:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(1));break;case 1:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();let t=7,e=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(t=2,e=3):this.shouldTreatAsStandardURL&&(t=2),this.changeState(t,e)}break;case 2:this.isIdentityTerminator()?this.rewindAndSetState(3):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(5);break;case 3:this.isPasswordPrefix()?this.changeState(4,1):this.isIdentityTerminator()&&this.changeState(5,1);break;case 4:this.isIdentityTerminator()&&this.changeState(5,1);break;case 5:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(6,1):this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 6:this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 7:this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 8:this.isHashPrefix()&&this.changeState(9,1);break;case 9:break;case 10:break}}}changeState(t,e){switch(this.state){case 0:break;case 1:this.internalResult.protocol=this.makeComponentString();break;case 2:break;case 3:this.internalResult.username=this.makeComponentString();break;case 4:this.internalResult.password=this.makeComponentString();break;case 5:this.internalResult.hostname=this.makeComponentString();break;case 6:this.internalResult.port=this.makeComponentString();break;case 7:this.internalResult.pathname=this.makeComponentString();break;case 8:this.internalResult.search=this.makeComponentString();break;case 9:this.internalResult.hash=this.makeComponentString();break;case 10:break}this.changeStateWithoutSettingComponent(t,e)}changeStateWithoutSettingComponent(t,e){this.state=t,this.componentStart=this.tokenIndex+e,this.tokenIndex+=e,this.tokenIncrement=0}rewind(){this.tokenIndex=this.componentStart,this.tokenIncrement=0}rewindAndSetState(t){this.rewind(),this.state=t}safeToken(t){return t<0&&(t=this.tokenList.length-t),t<this.tokenList.length?this.tokenList[t]:this.tokenList[this.tokenList.length-1]}isNonSpecialPatternChar(t,e){let r=this.safeToken(t);return r.value===e&&(r.type==="CHAR"||r.type==="ESCAPED_CHAR"||r.type==="INVALID_CHAR")}isProtocolSuffix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}nextIsAuthoritySlashes(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")}isIdentityTerminator(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")}isPasswordPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPortPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPathnameStart(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")}isSearchPrefix(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;let t=this.safeToken(this.tokenIndex-1);return t.type!=="NAME"&&t.type!=="REGEX"&&t.type!=="CLOSE"&&t.type!=="ASTERISK"}isHashPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")}isGroupOpen(){return this.tokenList[this.tokenIndex].type=="OPEN"}isGroupClose(){return this.tokenList[this.tokenIndex].type=="CLOSE"}isIPv6Open(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")}isIPv6Close(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")}makeComponentString(){let t=this.tokenList[this.tokenIndex],e=this.safeToken(this.componentStart).index;return this.input.substring(e,t.index)}computeShouldTreatAsStandardURL(){let t={};Object.assign(t,lt),t.encodePart=Uo;let e=Op(this.makeComponentString(),void 0,t);this.shouldTreatAsStandardURL=Y_(e)}},Io=["protocol","username","password","hostname","port","pathname","search","hash"],At="*";function b_(t,e){if(typeof t!="string")throw new TypeError("parameter 1 is not of type 'string'.");let r=new URL(t,e);return{protocol:r.protocol.substring(0,r.protocol.length-1),username:r.username,password:r.password,hostname:r.hostname,port:r.port,pathname:r.pathname,search:r.search!==""?r.search.substring(1,r.search.length):void 0,hash:r.hash!==""?r.hash.substring(1,r.hash.length):void 0}}function at(t,e){return e?De(t):t}function Ie(t,e,r){let n;if(typeof e.baseURL=="string")try{n=new URL(e.baseURL),t.protocol=at(n.protocol.substring(0,n.protocol.length-1),r),t.username=at(n.username,r),t.password=at(n.password,r),t.hostname=at(n.hostname,r),t.port=at(n.port,r),t.pathname=at(n.pathname,r),t.search=at(n.search.substring(1,n.search.length),r),t.hash=at(n.hash.substring(1,n.hash.length),r)}catch{throw new TypeError(`invalid baseURL '${e.baseURL}'.`)}if(typeof e.protocol=="string"&&(t.protocol=Vp(e.protocol,r)),typeof e.username=="string"&&(t.username=Up(e.username,r)),typeof e.password=="string"&&(t.password=Dp(e.password,r)),typeof e.hostname=="string"&&(t.hostname=Ip(e.hostname,r)),typeof e.port=="string"&&(t.port=bp(e.port,t.protocol,r)),typeof e.pathname=="string"){if(t.pathname=e.pathname,n&&!Pp(t.pathname,r)){let o=n.pathname.lastIndexOf("/");o>=0&&(t.pathname=at(n.pathname.substring(0,o+1),r)+t.pathname)}t.pathname=yp(t.pathname,t.protocol,r)}return typeof e.search=="string"&&(t.search=Lp(e.search,r)),typeof e.hash=="string"&&(t.hash=xp(e.hash,r)),t}function De(t){return t.replace(/([+*?:{}()\\])/g,"\\$1")}function Fp(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function Kp(t,e){e.delimiter??(e.delimiter="/#?"),e.prefixes??(e.prefixes="./"),e.sensitive??(e.sensitive=!1),e.strict??(e.strict=!1),e.end??(e.end=!0),e.start??(e.start=!0),e.endsWith="";let r=".*",n=`[^${Fp(e.delimiter)}]+?`,o=/[$_\u200C\u200D\p{ID_Continue}]/u,s="";for(let a=0;a<t.length;++a){let i=t[a];if(i.type===3){if(i.modifier===3){s+=De(i.value);continue}s+=`{${De(i.value)}}${jt(i.modifier)}`;continue}let c=i.hasCustomName(),E=!!i.suffix.length||!!i.prefix.length&&(i.prefix.length!==1||!e.prefixes.includes(i.prefix)),S=a>0?t[a-1]:null,u=a<t.length-1?t[a+1]:null;if(!E&&c&&i.type===1&&i.modifier===3&&u&&!u.prefix.length&&!u.suffix.length)if(u.type===3){let A=u.value.length>0?u.value[0]:"";E=o.test(A)}else E=!u.hasCustomName();if(!E&&!i.prefix.length&&S&&S.type===3){let A=S.value[S.value.length-1];E=e.prefixes.includes(A)}E&&(s+="{"),s+=De(i.prefix),c&&(s+=`:${i.name}`),i.type===2?s+=`(${i.value})`:i.type===1?c||(s+=`(${n})`):i.type===0&&(!c&&(!S||S.type===3||S.modifier!==3||E||i.prefix!=="")?s+="*":s+=`(${r})`),i.type===1&&c&&i.suffix.length&&o.test(i.suffix[0])&&(s+="\\"),s+=De(i.suffix),E&&(s+="}"),i.modifier!==3&&(s+=jt(i.modifier))}return s}var rn=class{constructor(t={},e,r){this.regexp={},this.names={},this.component_pattern={},this.parts={};try{let n;if(typeof e=="string"?n=e:r=e,typeof t=="string"){let i=new kp(t);if(i.parse(),t=i.result,n===void 0&&typeof t.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.");t.baseURL=n}else{if(!t||typeof t!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");if(n)throw new TypeError("parameter 1 is not of type 'string'.")}typeof r>"u"&&(r={ignoreCase:!1});let o={ignoreCase:r.ignoreCase===!0},s={pathname:At,protocol:At,username:At,password:At,hostname:At,port:At,search:At,hash:At};this.pattern=Ie(s,t,!0),k_(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");let a;for(a of Io){if(!(a in this.pattern))continue;let i={},c=this.pattern[a];switch(this.names[a]=[],a){case"protocol":Object.assign(i,lt),i.encodePart=Uo;break;case"username":Object.assign(i,lt),i.encodePart=vp;break;case"password":Object.assign(i,lt),i.encodePart=wp;break;case"hostname":Object.assign(i,Mp),G_(c)?i.encodePart=K_:i.encodePart=F_;break;case"port":Object.assign(i,lt),i.encodePart=j_;break;case"pathname":Y_(this.regexp.protocol)?(Object.assign(i,Cp,o),i.encodePart=Bp):(Object.assign(i,lt,o),i.encodePart=Gp);break;case"search":Object.assign(i,lt,o),i.encodePart=Hp;break;case"hash":Object.assign(i,lt,o),i.encodePart=Yp;break}try{this.parts[a]=v_(c,i),this.regexp[a]=w_(this.parts[a],this.names[a],i),this.component_pattern[a]=Kp(this.parts[a],i)}catch{throw new TypeError(`invalid ${a} pattern '${this.pattern[a]}'.`)}}}catch(n){throw new TypeError(`Failed to construct 'URLPattern': ${n.message}`)}}test(t={},e){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return!1;try{typeof t=="object"?r=Ie(r,t,!1):r=Ie(r,b_(t,e),!1)}catch{return!1}let n;for(n of Io)if(!this.regexp[n].exec(r[n]))return!1;return!0}exec(t={},e){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return;try{typeof t=="object"?r=Ie(r,t,!1):r=Ie(r,b_(t,e),!1)}catch{return null}let n={};e?n.inputs=[t,e]:n.inputs=[t];let o;for(o of Io){let s=this.regexp[o].exec(r[o]);if(!s)return null;let a={};for(let[i,c]of this.names[o].entries())if(typeof c=="string"||typeof c=="number"){let E=s[i+1];a[c]=E}n[o]={input:r[o]??"",groups:a}}return n}static compareComponent(t,e,r){let n=(i,c)=>{for(let E of["type","modifier","prefix","value","suffix"]){if(i[E]<c[E])return-1;if(i[E]===c[E])continue;return 1}return 0},o=new Ue(3,"","","","",3),s=new Ue(0,"","","","",3),a=(i,c)=>{let E=0;for(;E<Math.min(i.length,c.length);++E){let S=n(i[E],c[E]);if(S)return S}return i.length===c.length?0:n(i[E]??o,c[E]??o)};return!e.component_pattern[t]&&!r.component_pattern[t]?0:e.component_pattern[t]&&!r.component_pattern[t]?a(e.parts[t],[s]):!e.component_pattern[t]&&r.component_pattern[t]?a([s],r.parts[t]):a(e.parts[t],r.parts[t])}get protocol(){return this.component_pattern.protocol}get username(){return this.component_pattern.username}get password(){return this.component_pattern.password}get hostname(){return this.component_pattern.hostname}get port(){return this.component_pattern.port}get pathname(){return this.component_pattern.pathname}get search(){return this.component_pattern.search}get hash(){return this.component_pattern.hash}};globalThis.URLPattern||(globalThis.URLPattern=rn);var W_=(t,e)=>{var a;if(t===void 0)return{};let r=e.endsWith("/")?e.slice(0,-1):e,o=(a=new rn({pathname:t,baseURL:r}).exec(r))==null?void 0:a.pathname.groups;return o?Object.entries(o).reduce((i,[c,E])=>E===void 0?i:{...i,[c]:E},{}):{}};var nn=t=>t.headers.get(N_)||"";import{env as jp}from"process";var $_=()=>({region:jp.AWS_REGION});import{env as yo}from"process";var q_=()=>({id:yo.SITE_ID,name:yo.SITE_NAME,url:yo.URL});var Wp=typeof Response<"u"&&typeof Response.json=="function"?t=>Response.json(t):t=>new Response(JSON.stringify(t),{headers:{"content-type":"application/json"}}),X_=(t,e)=>{let r={},n=t[ge];try{r=W_(n,t.url)}catch{console.log(`Could not parse function route ${n}.`)}let o={enqueuedPromises:[]};return{context:{account:Jr(t),cookies:e.getPublicInterface(),deploy:Zr(t.headers),flags:L_(t),path:n,geo:D_(t.headers.get(l_)),ip:U_(t.headers.get(A_)),json:Wp,log:console.log,next:()=>{throw new Error("`context.next` is not implemented for serverless functions")},params:r,requestId:nn(t),rewrite:a=>{let i=$p(a,t.url);return qp(i)},server:$_(),site:q_(),url:new URL(t.url),waitUntil:function(i){if(arguments.length===0)throw new TypeError("waitUntil: At least 1 argument required, but only 0 passed");o.enqueuedPromises.push(Promise.resolve(i).catch(c=>console.error(c)))}},state:o}},$p=(t,e)=>{if(t instanceof URL)return t;if(t.startsWith("/")){let r=new URL(e);return r.pathname=t,r}return new URL(t)},qp=async t=>await fetch(t);import Q_ from"assert";function z_(t){function e(E,S=2){return E.padStart(S,"0")}let r=e(t.getUTCDate().toString()),n=e(t.getUTCHours().toString()),o=e(t.getUTCMinutes().toString()),s=e(t.getUTCSeconds().toString()),a=t.getUTCFullYear(),i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${i[t.getUTCDay()]}, ${r} ${c[t.getUTCMonth()]} ${a} ${n}:${o}:${s} GMT`}var Xp=/^(?=[\u0020-\u007E]*$)[^()@<>,;:\\"[\]?={}\s]+$/;function zp(t){if(!t.name)return"";let e=[];if(Qp(t.name),Zp(t.name,t.value),e.push(`${t.name}=${t.value}`),t.name.startsWith("__Secure")&&(t.secure=!0),t.name.startsWith("__Host")&&(t.path="/",t.secure=!0,delete t.domain),t.secure&&e.push("Secure"),t.httpOnly&&e.push("HttpOnly"),typeof t.maxAge=="number"&&Number.isInteger(t.maxAge)&&(Q_(t.maxAge>=0,"Max-Age must be an integer superior or equal to 0"),e.push(`Max-Age=${t.maxAge}`)),t.domain&&(tu(t.domain),e.push(`Domain=${t.domain}`)),t.sameSite&&e.push(`SameSite=${t.sameSite}`),t.path&&(Jp(t.path),e.push(`Path=${t.path}`)),t.expires){let{expires:r}=t,n=z_(typeof r=="number"?new Date(r):r);e.push(`Expires=${n}`)}return t.unparsed&&e.push(t.unparsed.join("; ")),e.join("; ")}function Qp(t){if(t&&!Xp.test(t))throw new TypeError(`Invalid cookie name: "${t}".`)}function Jp(t){if(t!=null)for(let e=0;e<t.length;e++){let r=t.charAt(e);if(r<" "||r>"~"||r==";")throw new Error(`${t}: Invalid cookie path char '${r}'`)}}function Zp(t,e){if(!(e==null||t==null))for(let r=0;r<e.length;r++){let n=e.charAt(r);if(n<"!"||n=='"'||n==","||n==";"||n=="\\"||n=="\x7F")throw new Error(`RFC2616 cookie '${t}' cannot contain character '${n}'`);if(n>"\x80")throw new Error(`RFC2616 cookie '${t}' can only have US-ASCII chars as value${n.charCodeAt(0).toString(16)}`)}}function tu(t){if(t==null)return;let e=t.charAt(0),r=t.charAt(t.length-1);if(e=="-"||r=="."||r=="-")throw new Error(`Invalid first/last char in cookie domain: ${t}`)}function J_(t){let e=t.get("Cookie");if(e!=null){let r={},n=e.split(";");for(let o of n){let[s,...a]=o.split("=");Q_(s!=null);let i=s.trim();r[i]=a.join("=")}return r}return{}}function bo(t,e){let r=zp(e);r&&t.append("Set-Cookie",r)}function Z_(t,e,r){bo(t,Object.assign({name:e,value:"",expires:new Date(0)},r))}var on=class{constructor(e){this.ops=[],this.request=e}apply(e){this.ops.forEach(r=>{switch(r.type){case"delete":Z_(e,r.options.name,{domain:r.options.domain,path:r.options.path});break;case"set":bo(e,r.cookie);break;default:}})}delete(e){let r={path:"/"},n=typeof e=="string"?{name:e}:e;this.ops.push({options:{...r,...n},type:"delete"})}get(e){return J_(this.request.headers)[e]}getPublicInterface(){return{delete:this.delete.bind(this),get:this.get.bind(this),set:this.set.bind(this)}}set(e,r){let n;if(typeof e=="string"){if(typeof r!="string")throw new TypeError("You must provide the cookie value as a string to 'cookies.set'");n={name:e,value:r}}else n=e;this.ops.push({cookie:n,type:"set"})}};import{Buffer as tE}from"buffer";import Vo from"process";var eu="NETLIFY_PURGE_API_TOKEN",ru="NETLIFY_BRANCH",nu="NETLIFY_BLOBS_CONTEXT",vo=t=>typeof t=="string"&&t.length!==0,eE=(t,e,r,n)=>{var a,i;let{blobs:o}=e,s=(i=(a=r==null?void 0:r.clientContext)==null?void 0:a.custom)==null?void 0:i.purge_api_token;if(vo(o))try{let c=tE.from(o,"base64").toString("utf8"),E=JSON.parse(c),S=t.get(R_),u=t.get(Qr);Vo.env[nu]=tE.from(JSON.stringify({edgeURL:E.url,uncachedEdgeURL:E.url_uncached,token:E.token,siteID:S,deployID:u,primaryRegion:E.primary_region})).toString("base64")}catch(c){console.error("An internal error occurred while setting up Netlify Blobs:",c)}vo(s)&&(Vo.env[eu]=s),vo(n==null?void 0:n.branch)&&(Vo.env[ru]=n.branch)};var rE=t=>t.headers.get(M_)??"";var nE=({awsRequestID:t,req:e,branch:r,functionName:n,logToken:o})=>{let s=new URL(e.url),a=nn(e),i={aws_req_id:t,aid:Jr(e).id,branch:r??"",did:Zr(e.headers).id,fn:n??"",host:s.host,log_token:o,method:e.method,nf_req_id:a,ts:Date.now(),path:s.pathname,span_id:rE(e)};xo({fields:i,type:"bootstrap/request"})},wo=({awsRequestID:t,result:e})=>{let r={aws_req_id:t};e instanceof Response?r.status=e.status:e instanceof Error?r.error_message=e.message:r.status=204,xo({fields:r,type:"bootstrap/response"})};var oE=!1,ou=t=>(...e)=>{let[r,n]=e;if(typeof r=="string"&&r.startsWith("/"))try{let o=G.getStore(),s=o==null?void 0:o.context.url;if(!s)throw new Error("Could not find request in context");let a=new URL(r,s);return t(a,n)}catch{Ft("An error occurred in the patched Response.redirect")}return t(...e)},sE=()=>{oE||(oE=!0,"Response"in globalThis&&Response.redirect&&(Response.redirect=ou(Response.redirect)))};import su from"http";import iu from"https";var au=globalThis.fetch,iE=t=>{let e=G.getStore();if(e!=null&&e.cdnLoopHeader){if(t.headersSent){Ft("Headers already sent, cannot add CDN-Loop header");return}t.setHeader("CDN-Loop",e==null?void 0:e.cdnLoopHeader)}};globalThis.fetch=function(e,r){let n=new Request(e,r),o=G.getStore();return o!=null&&o.cdnLoopHeader&&n.headers.set("CDN-Loop",o.cdnLoopHeader),au(n)};for(let t of[su,iu]){let e=t.request;t.get=function(...n){let o=e(...n);return iE(o),o.end(),o},t.request=function(...n){let o=e(...n);return iE(o),o}}var pu=Tu(Eu),uu=20,Au=t=>awslambda.streamifyResponse(async(e,r,n)=>{let o=Date.now(),s=n.awsRequestId,{body:a,flags:i,headers:c,httpMethod:E,invocationMetadata:S,isBase64Encoded:u,logToken:A,rawUrl:R,route:U}=e,y=new xe(i||{}),Y=C_(c),gt=x_(a,u),nt=y.get("serverless_functions_abort_signal")===!0?AbortSignal.timeout(n.getRemainingTimeInMillis()-uu):void 0,f=new tn(R,{body:gt,headers:Y,method:E,signal:nt}),N=!zr()&&y.get("serverless_functions_log_metadata")===!0;y.get("serverless_functions_response_redirect_relative")===!0&&sE(),N&&nE({awsRequestID:s,branch:S==null?void 0:S.branch,functionName:S==null?void 0:S.function_name,logToken:A,req:f}),eE(Y,e,n,S),I_(f,y),U&&(f[ge]=U),y.get("serverless_functions_wait_event_loop")===!0&&(n.callbackWaitsForEmptyEventLoop=!1);let M=new on(f),{context:x,state:be}=X_(f,M);await s_({headers:Y,serviceName:x.site.name||"",serviceVersion:x.deploy.id,deploymentEnvironment:x.deploy.context,siteUrl:x.site.url||"",siteId:x.site.id||"",siteName:x.site.name||""});let C=await Yo(),L={cacheAPI:u_(e),cdnLoopHeader:Y.get("cdn-loop"),context:x,operationCounter:new Xr},W=()=>lu({funcOrFuncPath:t,requestContext:L,req:f,logMetadata:N,awsRequestID:s,responseStream:r,cookies:M,featureFlags:y,state:be,startTimestamp:o});if(C)try{let{propagation:$,context:Ve}=await Promise.resolve().then(()=>(p(),Nt)),_E=$.extract(Ve.active(),Y);Ve.with(_E,async()=>{await C.withActiveSpan(x.requestId,W)})}finally{await ko()}else await W()}),aE=t=>t&&typeof t=="object"&&"default"in t?t.default:t,lu=async({funcOrFuncPath:t,requestContext:e,req:r,logMetadata:n,awsRequestID:o,responseStream:s,cookies:a,featureFlags:i,state:c,startTimestamp:E})=>{try{let S;if(typeof t=="string"){let u=await import(t),A=aE(aE(u));S=await G.run(e,()=>A(r,e.context))}else S=await G.run(e,()=>t.default(r,e.context));n&&wo({awsRequestID:o,result:S}),await fu(S,s,a,i,E)}catch(S){throw n&&wo({awsRequestID:o,result:S}),S}if(c.enqueuedPromises.length!==0)try{await Promise.allSettled(c.enqueuedPromises)}catch(S){console.error(S)}},fu=async(t,e,r,n,o)=>{let s={version:_u.version},a=cu.from(JSON.stringify(s)).toString("base64");if(t instanceof Response){let i=new Headers(t.headers);r.apply(i);let{body:c,status:E}=t,S=n.evaluations;S.size!==0&&i.set(h_,[...S].join(",")),i.set(Lo,a),i.set(O_,o.toString());let u={multiValueHeaders:P_(i),statusCode:E},A=awslambda.HttpResponseStream.from(e,u);if((n.get("serverless_functions_fix_empty_body")===!0||c===null)&&A.write(""),c===null){A.end();return}let R=Su.fromWeb(c);await pu(R,A);return}if(t===void 0){let i=awslambda.HttpResponseStream.from(e,{statusCode:204,headers:{[Lo]:a}});i.write(""),i.end();return}throw new kt("Function returned an unsupported value. Accepted types are 'Response' or 'undefined'")};import ye from"process";var du={delete:t=>{delete ye.env[t]},get:t=>ye.env[t],has:t=>!!ye.env[t],set:(t,e)=>{ye.env[t]=e},toObject:()=>Object.entries(ye.env).reduce((t,[e,r])=>r===void 0?t:{...t,[e]:r},{})},cE={get context(){let t=G.getStore();return(t==null?void 0:t.context)??null},env:du};globalThis.Netlify=cE;var mu=()=>cE;var HO=()=>Ru(import.meta.url);export{Au as getLambdaHandler,mu as getNetlifyGlobal,HO as getPath};
